<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="pageTitle">BCOS Homepage</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
	<!--
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='all.css') }}">
	-->
<link rel="stylesheet" href="{{ url_for('static', filename='all.css') }}">

    <script>
        // Load theme immediately before page renders to prevent flash
        (function() {
            const colorMatch = document.cookie.match(/themeColors=([^;]+)/);
            if (colorMatch) {
                try {
                    const colors = JSON.parse(decodeURIComponent(colorMatch[1]));
                    document.documentElement.style.setProperty('--bg-gradient-1', colors.bg1);
                    document.documentElement.style.setProperty('--bg-gradient-2', colors.bg2);
                    document.documentElement.style.setProperty('--bg-gradient-3', colors.bg3);
                    document.documentElement.style.setProperty('--bg-gradient-4', colors.bg4);
                    document.documentElement.style.setProperty('--text-primary', colors.text);
                    document.documentElement.style.setProperty('--url-color', colors.url);
                    document.documentElement.style.setProperty('--notes-color', colors.notes);
                    document.documentElement.style.setProperty('--calendar-color', colors.calendar || '#ec4899');
                    document.documentElement.style.setProperty('--quote-color', colors.quote || '#8b5cf6');
                    document.documentElement.style.setProperty('--suggestions-color', colors.suggestions || '#14b8a6');
                    if (colors.hoverBorder) document.documentElement.style.setProperty('--card-hover-border', colors.hoverBorder);
                    if (colors.opacity) document.documentElement.style.setProperty('--card-opacity', colors.opacity / 100);
                    if (colors.hoverOpacity) document.documentElement.style.setProperty('--card-hover-opacity', colors.hoverOpacity / 100);
                } catch (e) {
                    console.error('Error loading theme:', e);
                }
            }
        })();
    </script>

	<style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

html {
    overflow-x: hidden;
    overflow-y: auto;
    height: 100%;
}

body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    --bg-gradient-1: #e5e7eb;
    --bg-gradient-2: #d1d5db;
    --bg-gradient-3: #cbd5e1;
    --bg-gradient-4: #e2e8f0;
    --text-primary: #1f2937;
    --text-secondary: #6b7280;
    --card-bg: rgba(255, 255, 255, 0.8);
    --card-border: rgba(209, 213, 219, 0.6);
    --card-shadow: rgba(0, 0, 0, 0.1);
    --url-color: #3b82f6;
    --notes-color: #f59e0b;
    --calendar-color: #ec4899;
    --quote-color: #8b5cf6;
    --suggestions-color: #14b8a6;
    --card-hover-border: #3b82f6;
    --card-opacity: 0.8;
    --card-hover-opacity: 0.95;
    color: var(--text-primary);
    min-height: 100vh;
    overflow-x: hidden;
    position: static;
}

body::after {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    right: 0;
    bottom: 0;
    background: linear-gradient(-45deg, var(--bg-gradient-1), var(--bg-gradient-2), var(--bg-gradient-3), var(--bg-gradient-4));
    background-size: 400% 400%;
    animation: subtleFlow 30s ease-in-out infinite;
    z-index: -2;
    pointer-events: none;
}

@keyframes subtleFlow {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
}

body::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background-image:
        radial-gradient(circle at 20% 30%, var(--orb-1, rgba(59, 130, 246, 0.15)) 0%, transparent 50%),
        radial-gradient(circle at 80% 70%, var(--orb-2, rgba(139, 92, 246, 0.15)) 0%, transparent 50%),
        radial-gradient(circle at 50% 50%, var(--orb-3, rgba(236, 72, 153, 0.1)) 0%, transparent 50%);
    animation: floatingOrbs 25s ease-in-out infinite;
    pointer-events: none;
    z-index: 0;
    transition: all 0.5s ease;
}

@keyframes floatingOrbs {
    0%, 100% { transform: translate(0, 0) scale(1); opacity: 1; }
    50% { transform: translate(30px, -30px) scale(1.2); opacity: 0.8; }
}



.container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 1.5rem;
    position: relative;
    z-index: 1;
}

.columns-container {
    display: grid;
    grid-template-columns: minmax(300px, 1fr) minmax(400px, 1.5fr) minmax(300px, 1fr);
    gap: 1.5rem;
    margin-bottom: 2rem;
    align-items: flex-start;
}

.column[data-column="1"] {
   /* min-width: 300px;*/
}












	
/* Calendar card container */
.calendar-content {
    background: color-mix(in srgb, var(--calendar-color) 10%, transparent);
    border: 1px solid color-mix(in srgb, var(--calendar-color) 30%, transparent);
    border-radius: 12px;
    padding: 12px;
    margin: 0.5rem auto 0 auto;
    box-sizing: border-box;   /* include padding in width */
    width: 100%;
    max-width: 450px;
	min-width: 450px;                /* match calendar card with */
}


/* Quote card container */
.quote-content {
    background: color-mix(in srgb, var(--quote-color) 10%, transparent);
    border: 1px solid color-mix(in srgb, var(--quote-color) 30%, transparent);
    border-radius: 12px;
    padding: 12px;                  /* match calendar padding */
    margin: 0.5rem auto 0 auto;
    box-sizing: border-box;          /* include padding in width */
    width: 100%;
     max-width: 450px;                /* match calendar card width */
	 min-width: 450px;                /* match calendar card with */
    overflow-wrap: break-word;       /* wrap long words */
    word-break: break-word;          /* wrap long words */
}

/* Quote text */
.quote-text {
    font-size: 0.875rem;
    color: color-mix(in srgb, var(--quote-color) 100%, #000 10%);
    line-height: 1.4;
    white-space: pre-wrap;           /* preserves line breaks and wraps text */
    overflow-wrap: break-word;       /* wrap long words */
    word-break: break-word;          /* wrap long words */
}






.service-card {
    background: color-mix(in srgb, var(--bg-gradient-1) calc(var(--card-opacity) * 100%), transparent);
    border: 1px solid var(--card-border);
    border-radius: 16px;
    padding: 1rem;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
    cursor: pointer;
    width: 100%;
    max-width: 100%;
    box-sizing: border-box;
    box-shadow: 0 4px 6px -1px var(--card-shadow), 0 2px 4px -1px var(--card-shadow);
}



        .header {
            text-align: center;
            margin-bottom: 1rem;
            position: relative;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 600;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            letter-spacing: -0.02em;
        }

        .header p {
            font-size: 1rem;
            color: #94a3b8;
            font-weight: 400;
        }

        .admin-indicator {
            position: fixed;
            top: 1rem;
            right: 1rem;
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 12px;
            font-size: 0.875rem;
            font-weight: 600;
            z-index: 1000;
            display: none;
            box-shadow: 0 4px 12px color-mix(in srgb, var(--notes-color) 40%, transparent);
        }

        .admin-indicator.show {
            display: block;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 12px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            color: white;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            box-shadow: 0 4px 20px rgba(59, 130, 246, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(59, 130, 246, 0.4);
        }

        .btn-secondary {
            background: rgba(51, 65, 85, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(148, 163, 184, 0.3);
            color: #e2e8f0;
        }

        .btn-secondary:hover {
            background: rgba(51, 65, 85, 0.9);
            border-color: rgba(148, 163, 184, 0.5);
            transform: translateY(-2px);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            box-shadow: 0 4px 20px rgba(239, 68, 68, 0.3);
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(239, 68, 68, 0.4);
        }






        .column.drag-over {
            background: rgba(59, 130, 246, 0.1);
            border-color: rgba(59, 130, 246, 0.3);
        }

        .services-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }




        .service-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--card-hover-border), color-mix(in srgb, var(--card-hover-border) 100%, #000 30%));
            transform: translateX(-100%);
            transition: transform 0.3s ease;
        }

        .service-card:hover {
            transform: translateY(-4px) scale(1.01);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.15), 0 10px 10px -5px rgba(0, 0, 0, 0.1);
            border-color: color-mix(in srgb, var(--card-hover-border) 50%, transparent);
            background: color-mix(in srgb, var(--bg-gradient-1) calc(var(--card-hover-opacity) * 100%), transparent);
        }

        .service-card:hover::before {
            transform: translateX(0);
        }

        .service-card.dragging {
            opacity: 0.3;
            transform: scale(0.95);
        }

        .service-card.drag-placeholder {
            border: 2px dashed var(--url-color);
            background: color-mix(in srgb, var(--url-color) 10%, transparent);
            opacity: 0.5;
        }

        .service-card.drag-over::before {
            content: '';
            position: absolute;
            top: -3px;
            left: 0;
            right: 0;
            height: 3px;
            background: #3b82f6;
            z-index: 1000;
        }

        .service-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0;
        }

        .card-content {
            margin-top: 0.5rem;
        }

        .service-top-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            gap: 0.5rem;
        }

        .service-title-url {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex: 1;
            min-width: 0;
        }

        .service-title-url h3 {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            min-width: 0;
            flex: 1;
        }

        .service-info h3 {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            padding-right: 1rem;
        }

        .service-info p {
            color: var(--text-secondary);
            font-size: 0.75rem;
            margin: 0.25rem 0 0 0;
            line-height: 1.3;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            padding-right: 1rem;
        }

        .service-type-badge {
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 600;
            text-transform: uppercase;
            flex-shrink: 0;
        }

        .service-type-badge.url {
            background: rgba(59, 130, 246, 0.1);
            color: #1d4ed8;
            border: 1px solid rgba(59, 130, 246, 0.2);
        }

        .service-type-badge.search {
            background: rgba(16, 185, 129, 0.1);
            color: #047857;
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        .service-type-badge.notes {
            background: color-mix(in srgb, var(--notes-color) 10%, transparent);
            color: color-mix(in srgb, var(--notes-color) 100%, #000 40%);
            border: 1px solid color-mix(in srgb, var(--notes-color) 20%, transparent);
        }

        .service-type-badge.quote {
            background: color-mix(in srgb, var(--quote-color) 10%, transparent);
            color: color-mix(in srgb, var(--quote-color) 100%, #000 40%);
            border: 1px solid color-mix(in srgb, var(--quote-color) 20%, transparent);
        }

        .service-type-badge.calendar {
            background: color-mix(in srgb, var(--calendar-color) 10%, transparent);
            color: color-mix(in srgb, var(--calendar-color) 100%, #000 40%);
            border: 1px solid color-mix(in srgb, var(--calendar-color) 20%, transparent);
        }

        .service-type-badge.iframe {
            background: color-mix(in srgb, var(--quote-color) 10%, transparent);
            color: color-mix(in srgb, var(--quote-color) 100%, #000 40%);
            border: 1px solid color-mix(in srgb, var(--quote-color) 20%, transparent);
        }

        .service-actions {
            display: flex;
            gap: 4px;
            flex-shrink: 0;
            opacity: 1;
            transition: opacity 0.2s ease;
        }

        .service-card:hover .service-actions {
            opacity: 1;
        }

        .action-btn {
            width: 18px;
            height: 18px;
            border: none;
            border-radius: 4px;
            background: color-mix(in srgb, var(--text-primary) 20%, transparent);
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.65rem;
            border: 1px solid color-mix(in srgb, var(--text-primary) 30%, transparent);
            padding: 0;
            flex-shrink: 0;
        }

        .action-btn:hover {
            background: color-mix(in srgb, var(--text-primary) 30%, transparent);
            transform: scale(1.1);
        }

        .action-btn.edit:hover {
            background: color-mix(in srgb, var(--url-color) 25%, transparent);
            color: var(--url-color);
            border-color: color-mix(in srgb, var(--url-color) 40%, transparent);
        }

        .action-btn.delete:hover {
            background: rgba(239, 68, 68, 0.25);
            color: #ef4444;
            border-color: rgba(239, 68, 68, 0.4);
        }

        .action-btn.toggle-visibility {
            width: auto !important;
            height: auto !important;
            background: none !important;
            border: none !important;
            padding: 0 !important;
            margin: 0 !important;
            font-size: 0.9rem !important;
            color: var(--text-primary);
            opacity: 0.6;
            min-width: 0 !important;
            min-height: 0 !important;
            line-height: 1 !important;
        }

        .action-btn.toggle-visibility:hover {
            background: none;
            transform: none;
            opacity: 1;
        }

        .action-btn.toggle-visibility i {
            display: block;
            line-height: 1;
        }

        .search-box {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--card-border);
            border-radius: 8px;
            font-size: 0.875rem;
            margin-top: 0.5rem;
            background: transparent;
            color: var(--text-primary);
        }

        .search-box:focus {
            outline: none;
            border-color: var(--url-color);
            background: transparent;
        }

        .notes-content {
            background: color-mix(in srgb, var(--notes-color) 10%, transparent);
            border: 1px solid color-mix(in srgb, var(--notes-color) 30%, transparent);
            border-radius: 12px;
            padding: 8px 12px;
            margin-top: 0.5rem;
            font-size: 0.875rem;
            line-height: 1.4;
            color: var(--notes-color);
            white-space: pre-wrap;
            overflow-wrap: break-word;
            word-break: break-word;
        }

        /* Suggestions card styling */
        .suggestions-content {
            background: color-mix(in srgb, var(--suggestions-color) 10%, transparent);
            border: 1px solid color-mix(in srgb, var(--suggestions-color) 30%, transparent);
            border-radius: 12px;
            padding: 12px;
            margin-top: 0.5rem;
        }

        .suggestion-input-container {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }

        .suggestion-input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid var(--card-border);
            border-radius: 8px;
            font-size: 0.875rem;
            background: transparent;
            color: var(--text-primary);
            transition: all 0.2s ease;
        }

        .suggestion-input:focus {
            outline: none;
            border-color: var(--suggestions-color);
            background: transparent;
        }

        .suggestion-submit-btn {
            padding: 6px 12px;
            background: linear-gradient(135deg, var(--suggestions-color) 0%, color-mix(in srgb, var(--suggestions-color) 100%, #000 40%) 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 0.875rem;
            cursor: pointer;
            transition: opacity 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
            white-space: nowrap;
        }

        .suggestion-submit-btn:hover {
            opacity: 0.9;
        }

        .suggestions-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            max-height: 400px;
            overflow-y: auto;
            padding: 2px;
        }

        .suggestions-list::-webkit-scrollbar {
            width: 8px;
        }

        .suggestions-list::-webkit-scrollbar-track {
            background: transparent;
        }

        .suggestions-list::-webkit-scrollbar-thumb {
            background: color-mix(in srgb, var(--suggestions-color) 30%, transparent);
            border-radius: 4px;
        }

        .suggestions-list::-webkit-scrollbar-thumb:hover {
            background: color-mix(in srgb, var(--suggestions-color) 50%, transparent);
        }

        .suggestion-item {
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid color-mix(in srgb, var(--suggestions-color) 20%, transparent);
            border-radius: 8px;
            padding: 10px 12px;
            transition: all 0.2s ease;
        }

        .suggestion-item:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: color-mix(in srgb, var(--suggestions-color) 35%, transparent);
        }

        .suggestion-text {
            font-size: 0.9rem;
            color: var(--text-primary);
            margin-bottom: 8px;
            line-height: 1.5;
            word-wrap: break-word;
        }

        .suggestion-footer {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.75rem;
            color: var(--text-secondary);
            justify-content: flex-end;
        }

        .vote-buttons {
            display: flex;
            gap: 2px;
        }

        .vote-btn {
            display: flex;
            align-items: center;
            gap: 2px;
            padding: 4px 8px;
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid color-mix(in srgb, var(--suggestions-color) 30%, transparent);
            border-radius: 5px;
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .vote-btn i {
            font-size: 0.7rem;
        }

        .vote-btn.upvote:hover {
            background: linear-gradient(135deg, var(--suggestions-color) 0%, color-mix(in srgb, var(--suggestions-color) 100%, #000 20%) 100%);
            border-color: var(--suggestions-color);
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 2px 6px color-mix(in srgb, var(--suggestions-color) 40%, transparent);
        }

        .vote-btn.downvote:hover {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            border-color: #ef4444;
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 2px 6px rgba(239, 68, 68, 0.4);
        }

        .vote-count {
            font-weight: 700;
            min-width: 16px;
            text-align: center;
            font-size: 0.75rem;
        }

        .suggestion-score {
            padding: 3px 8px;
            background: linear-gradient(135deg, var(--suggestions-color) 0%, color-mix(in srgb, var(--suggestions-color) 100%, #000 20%) 100%);
            color: white;
            border-radius: 5px;
            font-weight: 700;
            font-size: 0.75rem;
        }

        .suggestion-score.negative {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }

        .suggestion-date {
            font-size: 0.7rem;
        }

        .edit-suggestion-btn,
        .delete-suggestion-btn {
            padding: 4px 8px;
            border: 1px solid;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.75rem;
        }

        .edit-suggestion-btn {
            background: rgba(59, 130, 246, 0.1);
            border-color: rgba(59, 130, 246, 0.3);
            color: #3b82f6;
        }

        .edit-suggestion-btn:hover {
            background: #3b82f6;
            color: white;
        }

        .delete-suggestion-btn {
            background: rgba(239, 68, 68, 0.1);
            border-color: rgba(239, 68, 68, 0.3);
            color: #ef4444;
        }

        .delete-suggestion-btn:hover {
            background: #ef4444;
            color: white;
        }

        .suggestion-date {
            margin-left: auto;
        }

        .loading-suggestions,
        .no-suggestions,
        .error-suggestions {
            text-align: center;
            padding: 20px;
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .no-suggestions {
            color: color-mix(in srgb, var(--suggestions-color) 100%, #000 20%);
        }

        .error-suggestions {
            color: #ef4444;
        }

        /* Clipboard Card Styles */
        .clipboard-content {
            background: color-mix(in srgb, var(--url-color) 10%, transparent);
            border: 1px solid color-mix(in srgb, var(--url-color) 30%, transparent);
            border-radius: 12px;
            padding: 12px;
            margin-top: 0.5rem;
        }

        .clipboard-textarea {
            width: 100%;
            min-height: 150px;
            padding: 12px;
            border: 1px solid color-mix(in srgb, var(--url-color) 20%, transparent);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.5);
            color: var(--text-primary);
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            font-size: 0.875rem;
            resize: vertical;
            margin-bottom: 8px;
        }

        .clipboard-textarea:focus {
            outline: none;
            border-color: var(--url-color);
        }

        .clipboard-formatting {
            display: flex;
            gap: 6px;
            margin-bottom: 8px;
            flex-wrap: wrap;
        }

        .clipboard-formatting .format-btn {
            padding: 4px 10px;
            border: 1px solid color-mix(in srgb, var(--url-color) 30%, transparent);
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.3);
            color: var(--text-primary);
            cursor: pointer;
            font-size: 0.75rem;
            transition: all 0.2s ease;
        }

        .clipboard-formatting .format-btn:hover {
            background: var(--url-color);
            color: white;
            border-color: var(--url-color);
        }

        .clipboard-actions {
            display: flex;
            gap: 8px;
            justify-content: flex-end;
        }

        .clipboard-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 8px;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 6px;
            white-space: nowrap;
        }

        .clipboard-btn.primary {
            background: linear-gradient(135deg, color-mix(in srgb, var(--url-color) 100%, #000 40%) 0%, color-mix(in srgb, var(--url-color) 100%, #000 65%) 100%);
            color: white;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
            box-shadow: 0 2px 8px color-mix(in srgb, var(--url-color) 40%, transparent);
        }

        .clipboard-btn.primary:hover {
            opacity: 0.9;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px color-mix(in srgb, var(--url-color) 50%, transparent);
        }

        .clipboard-btn.secondary {
            background: linear-gradient(135deg, color-mix(in srgb, var(--url-color) 100%, #000 40%) 0%, color-mix(in srgb, var(--url-color) 100%, #000 65%) 100%);
            border: 1px solid color-mix(in srgb, var(--url-color) 50%, transparent);
            color: white;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }

        .clipboard-btn.secondary:hover {
            opacity: 0.9;
            transform: translateY(-1px);
            border-color: var(--url-color);
        }

        /* File Share Card Styles */
        .fileshare-content {
            background: color-mix(in srgb, var(--url-color) 10%, transparent);
            border: 1px solid color-mix(in srgb, var(--url-color) 30%, transparent);
            border-radius: 12px;
            padding: 12px;
            margin-top: 0.5rem;
        }

        .fileshare-upload {
            display: flex;
            gap: 8px;
            justify-content: center;
            flex-wrap: nowrap;
            margin-top: 12px;
        }

        .fileshare-files {
            display: flex;
            flex-direction: column;
            gap: 6px;
            max-height: 300px;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 2px;
            margin: -2px;
        }

        .fileshare-file-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            background: rgba(255, 255, 255, 0.6);
            border: 1px solid color-mix(in srgb, var(--url-color) 20%, transparent);
            border-radius: 6px;
            transition: all 0.2s ease;
            cursor: pointer;
            text-decoration: none;
            color: var(--text-primary);
        }

        .fileshare-file-item:hover {
            background: color-mix(in srgb, var(--url-color) 15%, white);
            border-color: var(--url-color);
            transform: translateX(2px);
        }

        .fileshare-file-icon {
            font-size: 1.2rem;
            width: 24px;
            text-align: center;
            color: var(--url-color);
        }

        .fileshare-file-info {
            flex: 1;
            min-width: 0;
        }

        .fileshare-file-name {
            font-weight: 600;
            font-size: 0.875rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .fileshare-file-meta {
            font-size: 0.75rem;
            color: var(--text-secondary);
            display: flex;
            gap: 8px;
        }

        .loading-files,
        .no-files,
        .error-files {
            text-align: center;
            padding: 20px;
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .error-files {
            color: #ef4444;
        }

        .fileshare-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            white-space: nowrap;
        }

        .fileshare-btn.primary {
            background: linear-gradient(135deg, color-mix(in srgb, var(--url-color) 100%, #000 40%) 0%, color-mix(in srgb, var(--url-color) 100%, #000 65%) 100%);
            color: white;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
            box-shadow: 0 2px 8px color-mix(in srgb, var(--url-color) 40%, transparent);
        }

        .fileshare-btn.primary:hover {
            opacity: 0.9;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px color-mix(in srgb, var(--url-color) 50%, transparent);
        }

        .fileshare-btn.secondary {
            background: linear-gradient(135deg, color-mix(in srgb, var(--url-color) 100%, #000 40%) 0%, color-mix(in srgb, var(--url-color) 100%, #000 65%) 100%);
            border: 1px solid color-mix(in srgb, var(--url-color) 50%, transparent);
            color: white;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }

        .fileshare-btn.secondary:hover {
            opacity: 0.9;
            transform: translateY(-1px);
            border-color: var(--url-color);
        }


.icon-option {
    padding: 15px;
    border: 1px solid rgba(0,0,0,0.1);
    border-radius: 8px;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s ease;
    background: rgba(255,255,255,0.8);
	
}

.icon-option:hover {
    background: rgba(59, 130, 246, 0.1);
    border-color: #3b82f6;
    transform: scale(1.05);
}

.icon-option i {
    font-size: 1.5rem;
    color: #374151;
}



        .quote-author {
            font-size: 0.75rem;
            color: color-mix(in srgb, var(--quote-color) 100%, #000 20%);
            text-align: right;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(8px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: color-mix(in srgb, var(--bg-gradient-1) calc(var(--card-opacity) * 100%), transparent);
            backdrop-filter: blur(20px);
            border: 1px solid var(--card-border);
            border-radius: 20px;
            padding: 2rem;
            width: 90%;
            max-width: 500px;
            position: relative;
            box-shadow: 0 20px 60px var(--card-shadow);
            animation: modalSlide 0.3s ease-out;
        }

        @keyframes modalSlide {
            from {
                opacity: 0;
                transform: translateY(-20px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal h2 {
            color: var(--text-primary);
            margin-bottom: 1.5rem;
            font-size: 1.5rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px 16px;
            background: color-mix(in srgb, var(--bg-gradient-1) calc(var(--card-opacity) * 100%), transparent);
            border: 1px solid var(--card-border);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.2s ease;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #60a5fa;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }

        .form-group textarea {
            min-height: 80px;
            resize: vertical;
        }

        .form-group small {
            color: #64748b;
            font-size: 0.8rem;
            margin-top: 0.25rem;
            display: block;
        }

        .modal-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 2rem;
        }

        .empty-state {
            text-align: center;
            padding: 2rem 1rem;
            color: #64748b;
        }

        .empty-state i {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .empty-state h3 {
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
            color: #475569;
        }

        .loading {
            text-align: center;
            padding: 2rem;
            color: #64748b;
        }

        .error-message {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 12px;
            padding: 1rem;
            margin: 1rem 0;
            color: #dc2626;
        }

        .type-specific-fields {
            display: none;
        }

        .type-specific-fields.show {
            display: block;
        }


select[id*="day-"],
select[id*="month-"],
select[id*="year-"],
select[id*="phrase-"] {
    scrollbar-width: none;
    -ms-overflow-style: none;
    background: transparent !important;
    border: 1px solid color-mix(in srgb, var(--calendar-color) 30%, transparent) !important;
    outline: none;
    overflow-y: auto;
    padding: 4px 8px;
    color: var(--text-primary);
}

select[id*="day-"] option,
select[id*="month-"] option,
select[id*="year-"] option,
select[id*="phrase-"] option {
    background: transparent;
    color: var(--text-primary);
    padding: 4px 8px;
}

select[id*="day-"] option:checked,
select[id*="month-"] option:checked,
select[id*="year-"] option:checked,
select[id*="phrase-"] option:checked {
    background: linear-gradient(135deg, var(--calendar-color) 0%, color-mix(in srgb, var(--calendar-color) 100%, #000 20%) 100%);
    color: white;
    font-weight: 600;
}

select[id*="day-"]::-webkit-scrollbar,
select[id*="month-"]::-webkit-scrollbar,
select[id*="year-"]::-webkit-scrollbar,
select[id*="phrase-"]::-webkit-scrollbar {
    display: none;
}

/* Enable mouse wheel scrolling */
select[id*="day-"],
select[id*="month-"],
select[id*="year-"],
select[id*="phrase-"] {
    -webkit-overflow-scrolling: touch;
}

/* Calendar formatted phrase */
.calendar-formatted-phrase {
    font-weight: 600;
    color: color-mix(in srgb, var(--calendar-color) 100%, #000 40%);
    margin-bottom: 8px;
    padding: 8px;
    border-radius: 4px;
    text-align: center;
    word-break: break-word;
}

/* Calendar copy button */
.calendar-copy-btn {
    width: 100%;
    padding: 6px 12px;
    background: linear-gradient(135deg, var(--calendar-color) 0%, color-mix(in srgb, var(--calendar-color) 100%, #000 40%) 100%);
    color: white;
    border: none;
    border-radius: 6px;
    font-size: 0.875rem;
    cursor: pointer;
    transition: opacity 0.2s;
}

.calendar-copy-btn:hover {
    opacity: 0.9;
}

@media (max-width: 1400px) {
    .calendar-content,
    .quote-content {
        min-width: 0;
        max-width: 100%;
    }
}

@media (min-width: 1025px) and (max-width: 1150px) {
    .columns-container {
        grid-template-columns: minmax(250px, 1fr) minmax(350px, 1.5fr) minmax(250px, 1fr);
    }
}

@media (max-width: 1024px) {
    .container {
        max-width: 100%;
        padding: 1rem;
    }

    .columns-container {
        display: flex !important;
        flex-direction: column !important;
        gap: 1rem;
        grid-template-columns: none !important;
        align-items: center !important;
    }

    .column {
        width: 100% !important;
        min-width: unset !important;
        max-width: 500px !important;
    }

    .column[data-column="0"],
    .column[data-column="1"],
    .column[data-column="2"] {
        width: 100% !important;
        min-width: unset !important;
        max-width: 500px !important;
    }

    .service-card {
        max-width: 500px !important;
    }

    /* Calendar card container */
    .calendar-content {
        max-width: none;
        min-width: 0;
        width: 100%; /* Make it full width */
    }

    /* Quote card container */
    .quote-content {
        max-width: none;
        min-width: 0;
        width: 100%; /* Make it full width */
    }
}

@media (max-width: 760px) {
    .header h1 {
        font-size: 2rem;
    }
    
    .controls {
        justify-content: center;
        align-items: center;
        flex-wrap: wrap;
    }
    
    .btn {
        padding: 8px 16px;
        font-size: 0.85rem;
    }
    


    

    
	
	    /* Calendar card container */
    .calendar-content {
        max-width: none;
        min-width: 0;
        width: 100%; /* Make it full width */
    }

    /* Quote card container */
    .quote-content {
        max-width: none;
        min-width: 0;
        width: 100%; /* Make it full width */
    }
	
	
	
	
	
    /* Service card mobile adjustments */
    .service-card {
        margin-bottom: 0.5rem;
    }
    
    .service-top-row {
        flex-wrap: wrap;
    }
    
    .service-actions {
        opacity: 1;
    }
}

@media (max-width: 349px) {
    .container {
        padding: 0.75rem;
    }

    .service-card {
        padding: 0.5rem;
    }

    /* Calendar card container */
    .calendar-content {
        max-width: none;
        min-width: 0;
        width: 100%; /* Make it full width */
    }

    /* Quote card container */
    .quote-content {
        max-width: none;
        min-width: 0;
        width: 100%; /* Make it full width */
    }
}
 
	

@media (max-width: 768px) {
    body {
        background: linear-gradient(-45deg, var(--bg-gradient-1), var(--bg-gradient-2), var(--bg-gradient-3), var(--bg-gradient-4));
        background-size: 400% 400%;
        background-attachment: fixed;
        animation: subtleFlow 30s ease-in-out infinite;
        min-height: 100vh;
        min-width: 100vw;
    }

    body::before, body::after {
        display: none;
    }

    .theme-picker {
        bottom: 1rem !important;
        right: 1rem !important;
        width: auto !important;
        height: auto !important;
        max-width: 60px !important;
        max-height: 60px !important;
    }

    .theme-picker-toggle {
        bottom: 1rem !important;
        right: 1rem !important;
        position: relative !important;
    }
}

/* Theme Picker Styles */
.theme-picker {
    position: fixed !important;
    bottom: 32px !important;
    right: 32px !important;
    z-index: 99999 !important;
    pointer-events: none !important;
    transform: none !important;
    margin: 0 !important;
    padding: 0 !important;
    isolation: isolate !important;
    width: fit-content !important;
    height: fit-content !important;
}

.theme-picker > * {
    pointer-events: auto !important;
}

.theme-picker-toggle {
    position: fixed !important;
    bottom: 32px !important;
    right: 32px !important;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background: color-mix(in srgb, var(--bg-gradient-1) calc(var(--card-opacity) * 100%), transparent);
    border: 2px solid var(--card-border);
    box-shadow: 0 4px 12px var(--card-shadow);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    color: var(--text-primary);
    font-size: 1.2rem;
    z-index: 99999 !important;
}

.theme-picker-toggle:hover {
    transform: scale(1.05) rotate(10deg);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
}

.theme-picker-menu {
    position: fixed !important;
    bottom: 90px !important;
    right: 32px !important;
    background: color-mix(in srgb, var(--bg-gradient-1) calc(var(--card-opacity) * 100%), transparent);
    border: 1px solid var(--card-border);
    border-radius: 16px;
    padding: 1rem;
    box-shadow: 0 8px 24px var(--card-shadow);
    display: none;
    backdrop-filter: blur(20px);
    flex-direction: column;
    gap: 0.75rem;
    max-height: calc(100vh - 150px);
    overflow-y: auto;
    z-index: 100000 !important;
    transform: none !important;
    margin: 0 !important;
    isolation: isolate !important;
}

.theme-picker-menu.show {
    display: flex;
    animation: slideUp 0.2s ease-out;
}

.theme-picker-menu::-webkit-scrollbar {
    width: 6px;
}

.theme-picker-menu::-webkit-scrollbar-track {
    background: transparent;
}

.theme-picker-menu::-webkit-scrollbar-thumb {
    background: var(--card-border);
    border-radius: 3px;
}

.theme-picker-menu::-webkit-scrollbar-thumb:hover {
    background: var(--text-secondary);
}

.color-grid {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 0.5rem;
}

@keyframes slideUp {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.color-option {
    width: 40px;
    height: 40px;
    cursor: pointer;
    transition: all 0.2s ease;
    border: 3px solid transparent;
    border-radius: 10px;
    position: relative;
}

.color-option:hover {
    transform: scale(1.1);
    border-color: rgba(59, 130, 246, 0.3);
}

.color-option.active {
    border-color: rgba(59, 130, 246, 0.6);
    box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
}

.color-option.active::after {
    content: '\f00c';
    font-family: 'Font Awesome 5 Free';
    font-weight: 900;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: white;
    font-size: 0.875rem;
    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
}

.color-preview {
    width: 100%;
    height: 100%;
    border-radius: 7px;
    box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
    border: 1px solid rgba(0, 0, 0, 0.05);
}

.theme-section-title {
    font-size: 0.75rem;
    font-weight: 600;
    color: var(--text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: 0.5rem;
}

.theme-divider {
    height: 1px;
    background: var(--card-border);
    margin: 0.75rem 0;
}

.custom-colors {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 0.5rem;
}

.color-control {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
}

.color-control label {
    font-size: 0.75rem;
    font-weight: 500;
    color: var(--text-primary);
}

.color-control input[type="color"] {
    width: 100%;
    height: 36px;
    border: 1px solid var(--card-border);
    border-radius: 6px;
    cursor: pointer;
    background: transparent;
}

.color-control input[type="color"]::-webkit-color-swatch-wrapper {
    padding: 2px;
}

.color-control input[type="color"]::-webkit-color-swatch {
    border: none;
    border-radius: 4px;
}

.reset-theme-btn {
    width: 100%;
    padding: 0.5rem;
    background: rgba(239, 68, 68, 0.1);
    border: 1px solid rgba(239, 68, 68, 0.3);
    border-radius: 8px;
    color: #dc2626;
    font-size: 0.875rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    margin-top: 0.5rem;
}

.reset-theme-btn:hover {
    background: rgba(239, 68, 68, 0.15);
    border-color: rgba(239, 68, 68, 0.5);
    transform: translateY(-1px);
}

@media (max-width: 768px) {
    .theme-picker-menu {
        bottom: 70px !important;
        right: 1rem !important;
        left: auto !important;
        width: 200px !important;
        max-width: calc(100vw - 2rem);
        max-height: calc(100vh - 100px);
        padding: 0.5rem !important;
        font-size: 0.85rem !important;
    }

    .theme-section-title {
        font-size: 0.75rem !important;
        margin-bottom: 0.3rem !important;
    }

    .color-grid {
        grid-template-columns: repeat(2, 1fr) !important;
        gap: 0.3rem !important;
        margin-bottom: 0.3rem !important;
    }

    .color-option {
        width: 100% !important;
        height: 30px !important;
    }

    .custom-colors {
        grid-template-columns: 1fr 1fr !important;
        gap: 0.3rem !important;
    }

    .color-control {
        margin-bottom: 0 !important;
    }

    .color-control label {
        font-size: 0.65rem !important;
        margin-bottom: 0.1rem !important;
    }

    .color-control input[type="color"] {
        width: 100% !important;
        height: 28px !important;
    }

    .color-control input[type="range"] {
        height: 18px !important;
    }

    .reset-theme-btn {
        font-size: 0.7rem !important;
        padding: 0.4rem !important;
        margin-top: 0.3rem !important;
    }

    .theme-divider {
        margin: 0.3rem 0 !important;
    }

    .modal-content {
        width: 95% !important;
        max-width: 95% !important;
        padding: 1.5rem !important;
        max-height: 85vh !important;
        overflow-y: auto !important;
    }

    .modal h2 {
        font-size: 1.3rem !important;
    }

    .modal-actions {
        flex-direction: column !important;
        gap: 0.5rem !important;
    }

    .modal-actions button {
        width: 100% !important;
    }

    .custom-colors {
        grid-template-columns: 1fr 1fr !important;
    }

    .color-control label {
        font-size: 0.8rem !important;
    }

    .service-actions {
        opacity: 1 !important;
    }

    .action-btn {
        width: 32px !important;
        height: 32px !important;
        font-size: 0.85rem !important;
    }

    .action-btn.toggle-visibility {
        width: auto !important;
        height: auto !important;
        min-width: 0 !important;
        min-height: 0 !important;
    }

    /* Better touch targets */
    .btn {
        min-height: 44px !important;
        padding: 12px 16px !important;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
        font-size: 16px !important; /* Prevents zoom on iOS */
        min-height: 44px !important;
    }

    .icon-grid {
        grid-template-columns: repeat(auto-fill, minmax(60px, 1fr)) !important;
    }

    .icon-option {
        padding: 10px !important;
        min-height: 50px !important;
    }

    /* Calendar editor on mobile */
    select[id*="day-"],
    select[id*="month-"],
    select[id*="year-"],
    select[id*="phrase-"] {
        font-size: 14px !important;
        min-width: 80px !important;
    }

    .calendar-copy-btn {
        font-size: 0.9rem !important;
        padding: 10px 16px !important;
    }
}

/* Extra small devices */
@media (max-width: 480px) {
    .custom-colors {
        grid-template-columns: 1fr !important;
    }

    .theme-section {
        gap: 0.5rem !important;
    }

    .color-options {
        grid-template-columns: repeat(4, 1fr) !important;
    }
}

        }
    </style>
</head>
<body>
    <div class="container">
        {% if admin_mode %}
        <div class="admin-indicator show">
            <i class="fas fa-shield-alt"></i> Admin Mode
        </div>
        {% endif %}

        <div class="header" style="display: flex; align-items: center; justify-content: center; gap: 1rem;">
            <h1 id="siteTitle">BCOS</h1>
            <button id="editTitleBtn" onclick="editSiteTitle()" style="display: none; padding: 0.5rem 1rem; background: linear-gradient(135deg, var(--url-color) 0%, color-mix(in srgb, var(--url-color) 100%, #000 20%) 100%); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 0.875rem;">
                <i class="fas fa-edit"></i> Edit Title
            </button>
			
			<!--
			<h1><i class="fas fa-th-large"></i> Dashboard</h1>
            <p>Your personalized home dashboard</p>
			-->
        </div>

        {% if admin_mode %}
        <div class="controls">
            <button class="btn btn-primary" onclick="showAddModal()">
                <i class="fas fa-plus"></i> Add Tile
            </button>
            <button class="btn btn-secondary" onclick="saveCurrentVisibilityAsDefault()" title="Save current card visibility state as default for new users">
                <i class="fas fa-eye"></i> Set Default Visibility
            </button>
            <button class="btn btn-secondary" onclick="nukeAllCookies()" title="Clear all user cookies and local storage" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); border-color: #dc2626;">
                <i class="fas fa-radiation"></i> Nuke All Cookies
            </button>
            <button class="btn btn-secondary" onclick="nukeVisibilitySettings()" title="Reset all user visibility settings to server defaults" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); border-color: #d97706;">
                <i class="fas fa-eye-slash"></i> Nuke Visibility
            </button>
            <button class="btn btn-secondary" onclick="exportServices()">
                <i class="fas fa-download"></i> Export
            </button>
            <button class="btn btn-secondary" onclick="importServices()">
                <i class="fas fa-upload"></i> Import
            </button>
            <button class="btn btn-danger" onclick="adminLogout()">
                <i class="fas fa-sign-out-alt"></i> Logout
            </button>
        </div>
        {% endif %}

        <div class="columns-container" id="columnsContainer">
            <div class="column" data-column="0">
                <div class="services-list" id="column0"></div>
            </div>
            <div class="column" data-column="1">
                <div class="services-list" id="column1"></div>
            </div>
            <div class="column" data-column="2">
                <div class="services-list" id="column2"></div>
            </div>
        </div>

        <div id="loadingState" class="loading" style="display: none;">
            <i class="fas fa-spinner fa-spin"></i>
            <p>Loading tiles...</p>
        </div>
    </div>

    <!-- Add/Edit Modal -->
    <div class="modal" id="serviceModal">
        <div class="modal-content">
            <h2 id="modalTitle">Add Tile</h2>
            <div class="form-group">
                <label for="serviceName">Tile Name</label>
                <input type="text" id="serviceName" placeholder="e.g., My Notes">
				
				
				
<div class="form-group">
    <label for="serviceIcon">Icon</label>
    <div style="display: flex; gap: 10px; align-items: center;">
        <input type="text" id="serviceIcon" placeholder="Icon class"  style="flex: 1;">
        <button type="button" class="btn btn-secondary" onclick="showIconPicker()" style="padding: 8px 16px;">
            <i class="fas fa-icons"></i> Choose
        </button>
    </div>
</div>
				
				
				
            </div>
            <div class="form-group">
                <label for="serviceDescription">Description</label>
                <input type="text" id="serviceDescription" placeholder="Brief description">
            </div>
            <div class="form-group">
                <label for="serviceType">Tile Type</label>
                <select id="serviceType" onchange="handleTypeChange()">
                    <option value="url">URL Link</option>
                    <option value="search">Search Engine</option>
                    <option value="notes">Notes</option>
                    <option value="quote">Quote of the Day</option>
                    <option value="calendar">Calendar/Date</option>
                    <option value="iframe">Iframe</option>
                    <option value="suggestions">Suggestions Board</option>
                    <option value="clipboard">Clipboard Sync NShare</option>
                    <option value="fileshare">File Share NSync</option>
                </select>
            </div>
            
            <!-- URL Type Fields -->
            <div class="type-specific-fields show" id="urlFields">
                <div class="form-group">
                    <label for="serviceUrl">URL</label>
                    <input type="text" id="serviceUrl" placeholder="e.g., http://192.168.1.100:8080">
                </div>
            </div>
            
            <!-- Search Type Fields -->
            <div class="type-specific-fields" id="searchFields">
                <div class="form-group">
                    <label for="searchUrl">Search URL Template</label>
                    <input type="text" id="searchUrl" placeholder="e.g., https://www.google.com/search?q={query}">
                    <small>Use {query} as placeholder for search terms</small>
                </div>
            </div>
            
            <!-- Notes Type Fields -->
            <div class="type-specific-fields" id="notesFields">
                <div class="form-group">
                    <label for="notesContent">Notes Content</label>
                    <textarea id="notesContent" placeholder="Enter your notes here..."></textarea>
                </div>
            </div>
            
            <!-- Calendar Type Fields -->
            <div class="type-specific-fields" id="calendarFields">
                <div class="form-group">
                    <small>Calendar tiles automatically use current date and configurable phrases.</small>
                </div>
            </div>
            
            <!-- Iframe Type Fields -->
            <div class="type-specific-fields" id="iframeFields">
                <div class="form-group">
                    <label for="iframeUrl">Iframe URL</label>
                    <input type="text" id="iframeUrl" placeholder="e.g., https://example.com">
                </div>
                <div class="form-group">
                    <label for="iframeWidth">Width</label>
                    <select id="iframeWidth">
                        <option value="auto">Auto</option>
                        <option value="300px">300px</option>
                        <option value="400px">400px</option>
                        <option value="500px">500px</option>
                        <option value="600px">600px</option>
                        <option value="100%">100%</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="iframeHeight">Height</label>
                    <select id="iframeHeight">
                        <option value="auto">Auto (300px)</option>
                        <option value="200px">200px</option>
                        <option value="300px">300px</option>
                        <option value="400px">400px</option>
                        <option value="500px">500px</option>
                        <option value="600px">600px</option>
                    </select>
                </div>
            </div>

            <!-- Suggestions Type Fields -->
            <div class="type-specific-fields" id="suggestionsFields">
                <div class="form-group">
                    <small>Suggestions board allows anonymous submission and voting on suggestions.</small>
                </div>
            </div>

            <!-- Clipboard Type Fields -->
            <div class="type-specific-fields" id="clipboardFields">
                <div class="form-group">
                    <label for="clipboardServerUrl">NShare Server URL</label>
                    <input type="text" id="clipboardServerUrl" placeholder="e.g., http://192.168.2.6">
                    <small>URL of your nshare server (without /shared_text)</small>
                </div>
            </div>

            <!-- File Share Type Fields -->
            <div class="type-specific-fields" id="fileshareFields">
                <div class="form-group">
                    <label for="fileshareServerUrl">NShare Server URL</label>
                    <input type="text" id="fileshareServerUrl" placeholder="e.g., http://192.168.2.6">
                    <small>URL of your nshare server</small>
                </div>
                <div class="form-group">
                    <label for="fileshareMaxFiles">Max Files to Display</label>
                    <input type="number" id="fileshareMaxFiles" value="5" min="1" max="20">
                </div>
            </div>

            <div class="form-group">
                <label for="serviceColumn">Column</label>
                <select id="serviceColumn">
                    <option value="0">Column 1</option>
                    <option value="1">Column 2</option>
                    <option value="2">Column 3</option>
                </select>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="hideModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveService()">Save</button>
            </div>
        </div>
    </div>

    <input type="file" id="fileInput" accept=".json" style="display: none;" onchange="handleImport(event)">

<!-- Calendar Phrases Editor Modal -->
<div class="modal" id="calendarPhrasesModal">
    <div class="modal-content" style="max-width: 1200px; max-height: 80vh; overflow-y: auto;">
        <h2>Edit Calendar Phrases</h2>
        <div id="calendarPhrasesEditor"></div>
    </div>
</div>

<!-- Quotes Editor Modal -->
<div class="modal" id="quotesModal">
    <div class="modal-content" style="max-width: 800px; max-height: 80vh; overflow-y: auto;">
        <h2>Edit Quotes</h2>
        <div id="quotesEditor"></div>
        <div class="modal-actions">
            <button class="btn btn-secondary" onclick="hideQuotesModal()">Cancel</button>
            <button class="btn btn-primary" onclick="saveQuotes()">Save Quotes</button>
        </div>
    </div>
</div>



<!-- Icon Picker Modal -->
<div class="modal" id="iconPickerModal">
    <div class="modal-content" style="max-width: 600px;">
        <h2>Select Icon</h2>
        <div style="display: grid; grid-template-columns: repeat(8, 1fr); gap: 0px; max-height: 400px; overflow-y: auto;">
<div class="icon-option" data-icon="fas fa-home"><i class="fas fa-home"></i></div>
<div class="icon-option" data-icon="fas fa-server"><i class="fas fa-server"></i></div>
<div class="icon-option" data-icon="fas fa-desktop"><i class="fas fa-desktop"></i></div>
<div class="icon-option" data-icon="fas fa-laptop"><i class="fas fa-laptop"></i></div>
<div class="icon-option" data-icon="fas fa-mobile-alt"><i class="fas fa-mobile-alt"></i></div>
<div class="icon-option" data-icon="fas fa-wifi"><i class="fas fa-wifi"></i></div>
<div class="icon-option" data-icon="fas fa-cloud"><i class="fas fa-cloud"></i></div>
<div class="icon-option" data-icon="fas fa-database"><i class="fas fa-database"></i></div>
<div class="icon-option" data-icon="fas fa-tv"><i class="fas fa-tv"></i></div>
<div class="icon-option" data-icon="fas fa-gamepad"><i class="fas fa-gamepad"></i></div>
<div class="icon-option" data-icon="fas fa-music"><i class="fas fa-music"></i></div>
<div class="icon-option" data-icon="fas fa-video"><i class="fas fa-video"></i></div>
<div class="icon-option" data-icon="fas fa-camera"><i class="fas fa-camera"></i></div>
<div class="icon-option" data-icon="fas fa-folder"><i class="fas fa-folder"></i></div>
<div class="icon-option" data-icon="fas fa-file"><i class="fas fa-file"></i></div>
<div class="icon-option" data-icon="fas fa-book"><i class="fas fa-book"></i></div>
<div class="icon-option" data-icon="fas fa-cog"><i class="fas fa-cog"></i></div>
<div class="icon-option" data-icon="fas fa-tools"><i class="fas fa-tools"></i></div>
<div class="icon-option" data-icon="fas fa-chart-bar"><i class="fas fa-chart-bar"></i></div>
<div class="icon-option" data-icon="fas fa-fire"><i class="fas fa-fire"></i></div>

<div class="icon-option" data-icon="fas fa-envelope"><i class="fas fa-envelope"></i></div>
<div class="icon-option" data-icon="fas fa-user"><i class="fas fa-user"></i></div>
<div class="icon-option" data-icon="fas fa-users"><i class="fas fa-users"></i></div>
<div class="icon-option" data-icon="fas fa-search"><i class="fas fa-search"></i></div>
<div class="icon-option" data-icon="fas fa-lock"><i class="fas fa-lock"></i></div>
<div class="icon-option" data-icon="fas fa-unlock"><i class="fas fa-unlock"></i></div>
<div class="icon-option" data-icon="fas fa-heart"><i class="fas fa-heart"></i></div>
<div class="icon-option" data-icon="fas fa-star"><i class="fas fa-star"></i></div>
<div class="icon-option" data-icon="fas fa-comment"><i class="fas fa-comment"></i></div>
<div class="icon-option" data-icon="fas fa-bell"><i class="fas fa-bell"></i></div>
<div class="icon-option" data-icon="fas fa-calendar"><i class="fas fa-calendar"></i></div>
<div class="icon-option" data-icon="fas fa-map-marker-alt"><i class="fas fa-map-marker-alt"></i></div>
<div class="icon-option" data-icon="fas fa-shopping-cart"><i class="fas fa-shopping-cart"></i></div>
<div class="icon-option" data-icon="fas fa-paper-plane"><i class="fas fa-paper-plane"></i></div>
<div class="icon-option" data-icon="fas fa-lightbulb"><i class="fas fa-lightbulb"></i></div>
<div class="icon-option" data-icon="fas fa-gift"><i class="fas fa-gift"></i></div>
<div class="icon-option" data-icon="fas fa-flag"><i class="fas fa-flag"></i></div>
<div class="icon-option" data-icon="fas fa-map"><i class="fas fa-map"></i></div>
<div class="icon-option" data-icon="fas fa-clock"><i class="fas fa-clock"></i></div>
<div class="icon-option" data-icon="fas fa-bug"><i class="fas fa-bug"></i></div>
<div class="icon-option" data-icon="fas fa-paperclip"><i class="fas fa-paperclip"></i></div>
<div class="icon-option" data-icon="fas fa-thumbtack"><i class="fas fa-thumbtack"></i></div>
<div class="icon-option" data-icon="fas fa-trash"><i class="fas fa-trash"></i></div>
<div class="icon-option" data-icon="fas fa-pen"><i class="fas fa-pen"></i></div>
<div class="icon-option" data-icon="fas fa-edit"><i class="fas fa-edit"></i></div>
<div class="icon-option" data-icon="fas fa-clipboard"><i class="fas fa-clipboard"></i></div>
<div class="icon-option" data-icon="fas fa-paper-plane"><i class="fas fa-paper-plane"></i></div>
<div class="icon-option" data-icon="fas fa-exclamation-triangle"><i class="fas fa-exclamation-triangle"></i></div>
<div class="icon-option" data-icon="fas fa-check-circle"><i class="fas fa-check-circle"></i></div>
<div class="icon-option" data-icon="fas fa-times-circle"><i class="fas fa-times-circle"></i></div>
<div class="icon-option" data-icon="fas fa-question-circle"><i class="fas fa-question-circle"></i></div>
<div class="icon-option" data-icon="fas fa-info-circle"><i class="fas fa-info-circle"></i></div>
<div class="icon-option" data-icon="fas fa-lightning"><i class="fas fa-bolt"></i></div>
<div class="icon-option" data-icon="fas fa-snowflake"><i class="fas fa-snowflake"></i></div>
<div class="icon-option" data-icon="fas fa-leaf"><i class="fas fa-leaf"></i></div>
<div class="icon-option" data-icon="fas fa-globe"><i class="fas fa-globe"></i></div>
<div class="icon-option" data-icon="fas fa-plane"><i class="fas fa-plane"></i></div>
<div class="icon-option" data-icon="fas fa-car"><i class="fas fa-car"></i></div>
<div class="icon-option" data-icon="fas fa-bicycle"><i class="fas fa-bicycle"></i></div>
<div class="icon-option" data-icon="fas fa-ship"><i class="fas fa-ship"></i></div>
<div class="icon-option" data-icon="fas fa-truck"><i class="fas fa-truck"></i></div>
<div class="icon-option" data-icon="fas fa-motorcycle"><i class="fas fa-motorcycle"></i></div>
<div class="icon-option" data-icon="fas fa-subway"><i class="fas fa-subway"></i></div>
<div class="icon-option" data-icon="fas fa-bus"><i class="fas fa-bus"></i></div>
<div class="icon-option" data-icon="fas fa-taxi"><i class="fas fa-taxi"></i></div>
<div class="icon-option" data-icon="fas fa-train"><i class="fas fa-train"></i></div>
<div class="icon-option" data-icon="fas fa-battery-full"><i class="fas fa-battery-full"></i></div>
<div class="icon-option" data-icon="fas fa-battery-half"><i class="fas fa-battery-half"></i></div>
<div class="icon-option" data-icon="fas fa-battery-empty"><i class="fas fa-battery-empty"></i></div>
<div class="icon-option" data-icon="fas fa-plug"><i class="fas fa-plug"></i></div>
<div class="icon-option" data-icon="fas fa-lightbulb"><i class="fas fa-lightbulb"></i></div>
<div class="icon-option" data-icon="fas fa-microphone"><i class="fas fa-microphone"></i></div>
<div class="icon-option" data-icon="fas fa-volume-up"><i class="fas fa-volume-up"></i></div>
<div class="icon-option" data-icon="fas fa-volume-mute"><i class="fas fa-volume-mute"></i></div>
<div class="icon-option" data-icon="fas fa-headphones"><i class="fas fa-headphones"></i></div>
<div class="icon-option" data-icon="fas fa-magnet"><i class="fas fa-magnet"></i></div>
<div class="icon-option" data-icon="fas fa-shield-alt"><i class="fas fa-shield-alt"></i></div>
<div class="icon-option" data-icon="fas fa-key"><i class="fas fa-key"></i></div>
<div class="icon-option" data-icon="fas fa-wallet"><i class="fas fa-wallet"></i></div>
<div class="icon-option" data-icon="fas fa-credit-card"><i class="fas fa-credit-card"></i></div>
<div class="icon-option" data-icon="fas fa-coins"><i class="fas fa-coins"></i></div>
<div class="icon-option" data-icon="fas fa-chart-line"><i class="fas fa-chart-line"></i></div>
<div class="icon-option" data-icon="fas fa-bolt"><i class="fas fa-bolt"></i></div>
<div class="icon-option" data-icon="fas fa-code"><i class="fas fa-code"></i></div>
<div class="icon-option" data-icon="fas fa-terminal"><i class="fas fa-terminal"></i></div>
<div class="icon-option" data-icon="fas fa-network-wired"><i class="fas fa-network-wired"></i></div>
<div class="icon-option" data-icon="fas fa-rss"><i class="fas fa-rss"></i></div>
<div class="icon-option" data-icon="fas fa-wrench"><i class="fas fa-wrench"></i></div>
<div class="icon-option" data-icon="fas fa-hammer"><i class="fas fa-hammer"></i></div>
<div class="icon-option" data-icon="fas fa-broom"><i class="fas fa-broom"></i></div>
<div class="icon-option" data-icon="fas fa-archive"><i class="fas fa-archive"></i></div>
<div class="icon-option" data-icon="fas fa-box"><i class="fas fa-box"></i></div>
<div class="icon-option" data-icon="fas fa-paperclip"><i class="fas fa-paperclip"></i></div>
<div class="icon-option" data-icon="fas fa-paint-brush"><i class="fas fa-paint-brush"></i></div>
<div class="icon-option" data-icon="fas fa-pencil-alt"><i class="fas fa-pencil-alt"></i></div>
<div class="icon-option" data-icon="fas fa-ruler"><i class="fas fa-ruler"></i></div>
<div class="icon-option" data-icon="fas fa-compass"><i class="fas fa-compass"></i></div>
<div class="icon-option" data-icon="fas fa-map-signs"><i class="fas fa-map-signs"></i></div>
<div class="icon-option" data-icon="fas fa-hand-paper"><i class="fas fa-hand-paper"></i></div>
<div class="icon-option" data-icon="fas fa-hand-rock"><i class="fas fa-hand-rock"></i></div>
<div class="icon-option" data-icon="fas fa-hand-scissors"><i class="fas fa-hand-scissors"></i></div>
<div class="icon-option" data-icon="fas fa-hand-lizard"><i class="fas fa-hand-lizard"></i></div>
<div class="icon-option" data-icon="fas fa-hand-spock"><i class="fas fa-hand-spock"></i></div>
<div class="icon-option" data-icon="fas fa-rocket"><i class="fas fa-rocket"></i></div>
<div class="icon-option" data-icon="fas fa-atom"><i class="fas fa-atom"></i></div>
<div class="icon-option" data-icon="fas fa-flask"><i class="fas fa-flask"></i></div>
<div class="icon-option" data-icon="fas fa-microscope"><i class="fas fa-microscope"></i></div>
<div class="icon-option" data-icon="fas fa-brain"><i class="fas fa-brain"></i></div>
<div class="icon-option" data-icon="fas fa-syringe"><i class="fas fa-syringe"></i></div>
<div class="icon-option" data-icon="fas fa-heartbeat"><i class="fas fa-heartbeat"></i></div>
<div class="icon-option" data-icon="fas fa-stethoscope"><i class="fas fa-stethoscope"></i></div>
<div class="icon-option" data-icon="fas fa-pills"><i class="fas fa-pills"></i></div>
<div class="icon-option" data-icon="fas fa-hospital"><i class="fas fa-hospital"></i></div>
<div class="icon-option" data-icon="fas fa-ambulance"><i class="fas fa-ambulance"></i></div>
<div class="icon-option" data-icon="fas fa-first-aid"><i class="fas fa-first-aid"></i></div>
<div class="icon-option" data-icon="fas fa-hands-helping"><i class="fas fa-hands-helping"></i></div>
<div class="icon-option" data-icon="fas fa-pray"><i class="fas fa-pray"></i></div>
<div class="icon-option" data-icon="fas fa-church"><i class="fas fa-church"></i></div>
<div class="icon-option" data-icon="fas fa-book-open"><i class="fas fa-book-open"></i></div>
<div class="icon-option" data-icon="fas fa-graduation-cap"><i class="fas fa-graduation-cap"></i></div>
<div class="icon-option" data-icon="fas fa-university"><i class="fas fa-university"></i></div>
<div class="icon-option" data-icon="fas fa-address-book"><i class="fas fa-address-book"></i></div>
<div class="icon-option" data-icon="fas fa-address-card"><i class="fas fa-address-card"></i></div>
<div class="icon-option" data-icon="fas fa-adjust"><i class="fas fa-adjust"></i></div>
<div class="icon-option" data-icon="fas fa-air-freshener"><i class="fas fa-air-freshener"></i></div>
<div class="icon-option" data-icon="fas fa-align-center"><i class="fas fa-align-center"></i></div>
<div class="icon-option" data-icon="fas fa-align-justify"><i class="fas fa-align-justify"></i></div>
<div class="icon-option" data-icon="fas fa-align-left"><i class="fas fa-align-left"></i></div>
<div class="icon-option" data-icon="fas fa-align-right"><i class="fas fa-align-right"></i></div>
<div class="icon-option" data-icon="fas fa-allergies"><i class="fas fa-allergies"></i></div>
<div class="icon-option" data-icon="fas fa-ambulance"><i class="fas fa-ambulance"></i></div>
<div class="icon-option" data-icon="fas fa-american-sign-language-interpreting"><i class="fas fa-american-sign-language-interpreting"></i></div>
<div class="icon-option" data-icon="fas fa-anchor"><i class="fas fa-anchor"></i></div>
<div class="icon-option" data-icon="fas fa-angle-double-down"><i class="fas fa-angle-double-down"></i></div>
<div class="icon-option" data-icon="fas fa-angle-double-left"><i class="fas fa-angle-double-left"></i></div>
<div class="icon-option" data-icon="fas fa-angle-double-right"><i class="fas fa-angle-double-right"></i></div>
<div class="icon-option" data-icon="fas fa-angle-double-up"><i class="fas fa-angle-double-up"></i></div>
<div class="icon-option" data-icon="fas fa-angle-down"><i class="fas fa-angle-down"></i></div>
<div class="icon-option" data-icon="fas fa-angle-left"><i class="fas fa-angle-left"></i></div>
<div class="icon-option" data-icon="fas fa-angle-right"><i class="fas fa-angle-right"></i></div>
<div class="icon-option" data-icon="fas fa-angle-up"><i class="fas fa-angle-up"></i></div>
<div class="icon-option" data-icon="fas fa-ankh"><i class="fas fa-ankh"></i></div>
<div class="icon-option" data-icon="fas fa-apple-alt"><i class="fas fa-apple-alt"></i></div>
<div class="icon-option" data-icon="fas fa-archive"><i class="fas fa-archive"></i></div>
<div class="icon-option" data-icon="fas fa-archway"><i class="fas fa-archway"></i></div>
<div class="icon-option" data-icon="fas fa-arrow-alt-circle-down"><i class="fas fa-arrow-alt-circle-down"></i></div>
<div class="icon-option" data-icon="fas fa-arrow-alt-circle-left"><i class="fas fa-arrow-alt-circle-left"></i></div>
<div class="icon-option" data-icon="fas fa-arrow-alt-circle-right"><i class="fas fa-arrow-alt-circle-right"></i></div>
<div class="icon-option" data-icon="fas fa-arrow-alt-circle-up"><i class="fas fa-arrow-alt-circle-up"></i></div>
<div class="icon-option" data-icon="fas fa-arrow-circle-down"><i class="fas fa-arrow-circle-down"></i></div>
<div class="icon-option" data-icon="fas fa-arrow-circle-left"><i class="fas fa-arrow-circle-left"></i></div>
<div class="icon-option" data-icon="fas fa-arrow-circle-right"><i class="fas fa-arrow-circle-right"></i></div>
<div class="icon-option" data-icon="fas fa-arrow-circle-up"><i class="fas fa-arrow-circle-up"></i></div>
<div class="icon-option" data-icon="fas fa-arrow-down"><i class="fas fa-arrow-down"></i></div>
<div class="icon-option" data-icon="fas fa-arrow-left"><i class="fas fa-arrow-left"></i></div>
<div class="icon-option" data-icon="fas fa-arrow-right"><i class="fas fa-arrow-right"></i></div>
<div class="icon-option" data-icon="fas fa-arrow-up"><i class="fas fa-arrow-up"></i></div>
<div class="icon-option" data-icon="fas fa-arrows-alt"><i class="fas fa-arrows-alt"></i></div>
<div class="icon-option" data-icon="fas fa-arrows-alt-h"><i class="fas fa-arrows-alt-h"></i></div>
<div class="icon-option" data-icon="fas fa-arrows-alt-v"><i class="fas fa-arrows-alt-v"></i></div>
<div class="icon-option" data-icon="fas fa-assistive-listening-systems"><i class="fas fa-assistive-listening-systems"></i></div>
<div class="icon-option" data-icon="fas fa-asterisk"><i class="fas fa-asterisk"></i></div>
<div class="icon-option" data-icon="fas fa-at"><i class="fas fa-at"></i></div>
<div class="icon-option" data-icon="fas fa-atlas"><i class="fas fa-atlas"></i></div>
<div class="icon-option" data-icon="fas fa-atom"><i class="fas fa-atom"></i></div>
<div class="icon-option" data-icon="fas fa-audio-description"><i class="fas fa-audio-description"></i></div>
<div class="icon-option" data-icon="fas fa-award"><i class="fas fa-award"></i></div>
<div class="icon-option" data-icon="fas fa-baby"><i class="fas fa-baby"></i></div>
<div class="icon-option" data-icon="fas fa-baby-carriage"><i class="fas fa-baby-carriage"></i></div>
<div class="icon-option" data-icon="fas fa-backspace"><i class="fas fa-backspace"></i></div>
<div class="icon-option" data-icon="fas fa-backward"><i class="fas fa-backward"></i></div>
<div class="icon-option" data-icon="fas fa-bacon"><i class="fas fa-bacon"></i></div>
<div class="icon-option" data-icon="fas fa-bacteria"><i class="fas fa-bacteria"></i></div>
<div class="icon-option" data-icon="fas fa-bacterium"><i class="fas fa-bacterium"></i></div>
<div class="icon-option" data-icon="fas fa-badge"><i class="fas fa-badge"></i></div>
<div class="icon-option" data-icon="fas fa-balance-scale"><i class="fas fa-balance-scale"></i></div>
<div class="icon-option" data-icon="fas fa-balance-scale-left"><i class="fas fa-balance-scale-left"></i></div>
<div class="icon-option" data-icon="fas fa-balance-scale-right"><i class="fas fa-balance-scale-right"></i></div>
<div class="icon-option" data-icon="fas fa-ban"><i class="fas fa-ban"></i></div>
<div class="icon-option" data-icon="fas fa-band-aid"><i class="fas fa-band-aid"></i></div>
<div class="icon-option" data-icon="fas fa-barcode"><i class="fas fa-barcode"></i></div>
<div class="icon-option" data-icon="fas fa-bars"><i class="fas fa-bars"></i></div>
<div class="icon-option" data-icon="fas fa-baseball-ball"><i class="fas fa-baseball-ball"></i></div>
<div class="icon-option" data-icon="fas fa-basketball-ball"><i class="fas fa-basketball-ball"></i></div>
<div class="icon-option" data-icon="fas fa-bath"><i class="fas fa-bath"></i></div>
<div class="icon-option" data-icon="fas fa-battery-empty"><i class="fas fa-battery-empty"></i></div>
<div class="icon-option" data-icon="fas fa-battery-full"><i class="fas fa-battery-full"></i></div>
<div class="icon-option" data-icon="fas fa-battery-half"><i class="fas fa-battery-half"></i></div>
<div class="icon-option" data-icon="fas fa-battery-quarter"><i class="fas fa-battery-quarter"></i></div>
<div class="icon-option" data-icon="fas fa-battery-three-quarters"><i class="fas fa-battery-three-quarters"></i></div>
<div class="icon-option" data-icon="fas fa-bed"><i class="fas fa-bed"></i></div>
<div class="icon-option" data-icon="fas fa-beer"><i class="fas fa-beer"></i></div>
<div class="icon-option" data-icon="fas fa-bell"><i class="fas fa-bell"></i></div>
<div class="icon-option" data-icon="fas fa-bell-slash"><i class="fas fa-bell-slash"></i></div>
<div class="icon-option" data-icon="fas fa-bezier-curve"><i class="fas fa-bezier-curve"></i></div>
<div class="icon-option" data-icon="fas fa-bible"><i class="fas fa-bible"></i></div>
<div class="icon-option" data-icon="fas fa-bicycle"><i class="fas fa-bicycle"></i></div>
<div class="icon-option" data-icon="fas fa-biking"><i class="fas fa-biking"></i></div>
<div class="icon-option" data-icon="fas fa-binoculars"><i class="fas fa-binoculars"></i></div>
<div class="icon-option" data-icon="fas fa-biohazard"><i class="fas fa-biohazard"></i></div>
<div class="icon-option" data-icon="fas fa-birthday-cake"><i class="fas fa-birthday-cake"></i></div>
<div class="icon-option" data-icon="fas fa-blender"><i class="fas fa-blender"></i></div>
<div class="icon-option" data-icon="fas fa-blind"><i class="fas fa-blind"></i></div>
<div class="icon-option" data-icon="fas fa-blog"><i class="fas fa-blog"></i></div>
<div class="icon-option" data-icon="fas fa-bold"><i class="fas fa-bold"></i></div>
<div class="icon-option" data-icon="fas fa-bolt"><i class="fas fa-bolt"></i></div>
<div class="icon-option" data-icon="fas fa-bomb"><i class="fas fa-bomb"></i></div>
<div class="icon-option" data-icon="fas fa-bone"><i class="fas fa-bone"></i></div>
<div class="icon-option" data-icon="fas fa-bong"><i class="fas fa-bong"></i></div>
<div class="icon-option" data-icon="fas fa-book"><i class="fas fa-book"></i></div>
<div class="icon-option" data-icon="fas fa-book-dead"><i class="fas fa-book-dead"></i></div>
<div class="icon-option" data-icon="fas fa-book-medical"><i class="fas fa-book-medical"></i></div>
<div class="icon-option" data-icon="fas fa-book-open"><i class="fas fa-book-open"></i></div>
<div class="icon-option" data-icon="fas fa-book-reader"><i class="fas fa-book-reader"></i></div>
<div class="icon-option" data-icon="fas fa-books"><i class="fas fa-books"></i></div>
<div class="icon-option" data-icon="fas fa-boom"><i class="fas fa-boom"></i></div>
<div class="icon-option" data-icon="fas fa-bowling-ball"><i class="fas fa-bowling-ball"></i></div>
<div class="icon-option" data-icon="fas fa-box"><i class="fas fa-box"></i></div>
<div class="icon-option" data-icon="fas fa-box-open"><i class="fas fa-box-open"></i></div>
<div class="icon-option" data-icon="fas fa-boxes"><i class="fas fa-boxes"></i></div>
<div class="icon-option" data-icon="fas fa-braille"><i class="fas fa-braille"></i></div>
<div class="icon-option" data-icon="fas fa-brain"><i class="fas fa-brain"></i></div>
<div class="icon-option" data-icon="fas fa-bread-slice"><i class="fas fa-bread-slice"></i></div>
<div class="icon-option" data-icon="fas fa-briefcase"><i class="fas fa-briefcase"></i></div>
<div class="icon-option" data-icon="fas fa-briefcase-medical"><i class="fas fa-briefcase-medical"></i></div>
<div class="icon-option" data-icon="fas fa-broadcast-tower"><i class="fas fa-broadcast-tower"></i></div>
<div class="icon-option" data-icon="fas fa-broom"><i class="fas fa-broom"></i></div>
<div class="icon-option" data-icon="fas fa-brush"><i class="fas fa-brush"></i></div>
<div class="icon-option" data-icon="fas fa-bug"><i class="fas fa-bug"></i></div>
<div class="icon-option" data-icon="fas fa-building"><i class="fas fa-building"></i></div>
<div class="icon-option" data-icon="fas fa-bullhorn"><i class="fas fa-bullhorn"></i></div>
<div class="icon-option" data-icon="fas fa-bullseye"><i class="fas fa-bullseye"></i></div>
<div class="icon-option" data-icon="fas fa-burn"><i class="fas fa-burn"></i></div>
<div class="icon-option" data-icon="fas fa-bus"><i class="fas fa-bus"></i></div>
<div class="icon-option" data-icon="fas fa-bus-alt"><i class="fas fa-bus-alt"></i></div>
<div class="icon-option" data-icon="fas fa-business-time"><i class="fas fa-business-time"></i></div>
<div class="icon-option" data-icon="fas fa-calculator"><i class="fas fa-calculator"></i></div>
<div class="icon-option" data-icon="fas fa-calendar"><i class="fas fa-calendar"></i></div>
<div class="icon-option" data-icon="fas fa-calendar-alt"><i class="fas fa-calendar-alt"></i></div>
<div class="icon-option" data-icon="fas fa-calendar-check"><i class="fas fa-calendar-check"></i></div>
<div class="icon-option" data-icon="fas fa-calendar-day"><i class="fas fa-calendar-day"></i></div>
<div class="icon-option" data-icon="fas fa-calendar-minus"><i class="fas fa-calendar-minus"></i></div>
<div class="icon-option" data-icon="fas fa-calendar-plus"><i class="fas fa-calendar-plus"></i></div>
<div class="icon-option" data-icon="fas fa-calendar-times"><i class="fas fa-calendar-times"></i></div>
<div class="icon-option" data-icon="fas fa-calendar-week"><i class="fas fa-calendar-week"></i></div>

        </div>
        <div class="modal-actions">
            <button class="btn btn-secondary" onclick="hideIconPicker()">Cancel</button>
        </div>
    </div>
</div>


    <script>
        let services = [];
        let editingIndex = -1;
        let draggedService = null;
        let calendarConfig = {};
        let isAdminMode = {{ admin_mode|tojson }};
		
		const serviceIcons = {
			url: 'fas fa-external-link-alt',
			search: 'fas fa-search',
			notes: 'fas fa-sticky-note',
			quote: 'fas fa-quote-right',
			calendar: 'fas fa-calendar-alt',
			iframe: 'fas fa-window-maximize',
			suggestions: 'fas fa-lightbulb',
			clipboard: 'fas fa-clipboard',
			fileshare: 'fas fa-folder-open'
		};

        // Check for nuke timestamp and clear local storage if needed
        async function checkNukeTimestamp() {
            try {
                const response = await fetch('/api/nuke-timestamp');
                const data = await response.json();

                if (data.success) {
                    // Check for full cookie nuke
                    if (data.timestamp) {
                        const nukeTimestamp = data.timestamp;
                        const lastNukeCheck = localStorage.getItem('lastNukeCheck');

                        if (nukeTimestamp !== lastNukeCheck) {
                            // Clear all local storage
                            localStorage.clear();
                            // Remember this nuke so we don't clear again
                            localStorage.setItem('lastNukeCheck', nukeTimestamp);
                            // Clear all cookies
                            const cookies = document.cookie.split(";");
                            for (let cookie of cookies) {
                                const eqPos = cookie.indexOf("=");
                                const name = eqPos > -1 ? cookie.substr(0, eqPos).trim() : cookie.trim();
                                document.cookie = name + "=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/";
                            }
                            console.log('Cookies and local storage nuked at timestamp:', nukeTimestamp);
                            // Reload the page to apply defaults
                            window.location.reload();
                        }
                    }

                    // Check for visibility-only nuke
                    if (data.visibility_timestamp) {
                        const visTimestamp = data.visibility_timestamp;
                        const lastVisNukeCheck = localStorage.getItem('lastVisibilityNukeCheck');

                        if (visTimestamp !== lastVisNukeCheck) {
                            // Clear only visibility settings
                            localStorage.removeItem('cardVisibility');
                            // Remember this nuke so we don't clear again
                            localStorage.setItem('lastVisibilityNukeCheck', visTimestamp);
                            console.log('Visibility settings nuked at timestamp:', visTimestamp);
                            // Reload the page to apply default visibility
                            window.location.reload();
                        }
                    }
                }
            } catch (error) {
                console.error('Error checking nuke timestamp:', error);
            }
        }

        // Initialize the app
		document.addEventListener('DOMContentLoaded', async function() {
            await checkNukeTimestamp(); // Check if cookies should be nuked
			await loadDefaultVisibility(); // Load default visibility for new users
			await loadCalendarConfig(); // wait for config before using it
			loadServices();
			if (isAdminMode) {
				setupDragAndDrop();
				document.getElementById('editTitleBtn').style.display = 'block';
			}

			// Now safe to generate options
			const optionsHtml = generatePhraseOptions(1);
			//console.log(optionsHtml);
		});


        // API functions
        async function apiRequest(url, options = {}) {
            try {
                const response = await fetch(url, {
                    credentials: 'include',  // Include cookies for session authentication
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    },
                    ...options
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                return await response.json();
            } catch (error) {
                //console.error('API request failed:', error);
                showError('Failed to communicate with server: ' + error.message);
                throw error;
            }
        }

        // Card visibility management functions
        let defaultVisibilityLoaded = false;
        let defaultVisibility = {};

        async function loadDefaultVisibility() {
            try {
                const response = await fetch('/api/default-visibility');
                const data = await response.json();
                if (data.success) {
                    defaultVisibility = data.visibility || {};
                    defaultVisibilityLoaded = true;
                }
            } catch (e) {
                console.error('Error loading default visibility:', e);
                defaultVisibilityLoaded = true; // Mark as loaded even on error
            }
        }

        function getCardVisibilityState() {
            try {
                const state = localStorage.getItem('cardVisibility');
                if (state) {
                    return JSON.parse(state);
                } else if (defaultVisibilityLoaded && Object.keys(defaultVisibility).length > 0) {
                    // First time user - apply default visibility
                    saveCardVisibilityState(defaultVisibility);
                    return defaultVisibility;
                }
                return {};
            } catch (e) {
                console.error('Error loading card visibility state:', e);
                return {};
            }
        }

        function saveCardVisibilityState(state) {
            try {
                localStorage.setItem('cardVisibility', JSON.stringify(state));
            } catch (e) {
                console.error('Error saving card visibility state:', e);
            }
        }

        function getCardId(index) {
            // Create a unique ID for the card based on name and type
            if (services[index]) {
                return `${services[index].type}_${services[index].name}`;
            }
            return `card_${index}`;
        }

        function isCardHidden(index) {
            const state = getCardVisibilityState();
            const cardId = getCardId(index);
            return state[cardId] === true;
        }

        function setCardVisibility(index, hidden) {
            const state = getCardVisibilityState();
            const cardId = getCardId(index);
            if (hidden) {
                state[cardId] = true;
            } else {
                delete state[cardId];
            }
            saveCardVisibilityState(state);
        }

        function toggleCardVisibility(event, index) {
            event.stopPropagation();

            const isHidden = isCardHidden(index);
            const newHiddenState = !isHidden;

            // Update localStorage
            setCardVisibility(index, newHiddenState);

            // Update the card's content visibility using data-card-index attribute
            const cardContent = document.querySelector(`.card-content[data-card-index="${index}"]`);
            if (cardContent) {
                cardContent.style.display = newHiddenState ? 'none' : 'block';
            }

            // Update the button icon
            const button = event.currentTarget;
            const icon = button.querySelector('i');
            if (icon) {
                icon.className = newHiddenState ? 'fas fa-eye-slash' : 'fas fa-eye';
            }
            button.title = newHiddenState ? 'Show' : 'Hide';
        }

        // Load services from server
        async function loadServices() {
            showLoading(true);
            try {
                const data = await apiRequest('/api/services');
                services = data.services || [];
                renderServices();
            } catch (error) {
                showError('Failed to load services from server');
                services = [];
                renderServices();
            }
            showLoading(false);
        }

        // Load calendar configuration
        async function loadCalendarConfig() {
            try {
                const data = await apiRequest('/api/calendar-config');
                calendarConfig = data.config || {};

                // Update site title if present
                if (calendarConfig.siteTitle) {
                    document.getElementById('siteTitle').textContent = calendarConfig.siteTitle;
                    document.getElementById('pageTitle').textContent = calendarConfig.siteTitle + ' Homepage';
                }
            } catch (error) {
                //console.error('Failed to load calendar config:', error);
                calendarConfig = {};
            }
        }

        // Save services to server
        async function saveServicesToServer() {
            try {
                await apiRequest('/api/services', {
                    method: 'POST',
                    body: JSON.stringify({ services })
                });
            } catch (error) {
                showError('Failed to save services to server');
                throw error;
            }
        }

        // Render services grid
        function renderServices() {
            // Clear all columns
            for (let i = 0; i < 3; i++) {
                const column = document.getElementById(`column${i}`);
                column.innerHTML = '';
            }

            if (services.length === 0) {
                document.getElementById('column1').innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-th-large"></i>
                        <h3>No tiles configured</h3>
                        <p>Add your first tile to get started</p>
                    </div>
                `;
                return;
            }

            // Group services by column
            services.forEach((service, index) => {
                const column = Math.max(0, Math.min(2, service.column || 0));
                const card = createServiceCard(service, index);
                document.getElementById(`column${column}`).appendChild(card);
            });

            // Initialize quotes and suggestions after rendering
            setTimeout(() => {
                services.forEach((service, index) => {
                    if (service.type === 'quote') {
                        loadQuoteForCard(index);
                    } else if (service.type === 'suggestions') {
                        loadSuggestionsForCard(index);
                    } else if (service.type === 'clipboard') {
                        loadClipboardContent(index);
                        // Auto-save on textarea change
                        setTimeout(() => {
                            const textarea = document.getElementById(`clipboardText-${index}`);
                            if (textarea) {
                                textarea.addEventListener('blur', () => saveClipboardContent(index));
                            }
                        }, 200);
                    } else if (service.type === 'fileshare') {
                        loadFileshareContent(index);
                    }
                });
            }, 100);
        }

        // Create service card element
        function createServiceCard(service, index) {
            const card = document.createElement('div');
            card.className = `service-card ${service.type}`;
            if (isAdminMode) {
                card.draggable = true;
            }
            card.dataset.serviceIndex = index;
            
            let cardContent = '';
            
            switch (service.type) {
                case 'url':
                    cardContent = createUrlCard(service, index);
                    break;
                case 'search':
                    cardContent = createSearchCard(service, index);
                    break;
                case 'notes':
                    cardContent = createNotesCard(service, index);
                    break;
                case 'quote':
                    cardContent = createQuoteCard(service, index);
                    break;
                case 'calendar':
                    cardContent = createCalendarCard(service, index);
                    break;
                case 'iframe':
                    cardContent = createIframeCard(service, index);
                    break;
                case 'suggestions':
                    cardContent = createSuggestionsCard(service, index);
                    break;
                case 'clipboard':
                    cardContent = createClipboardCard(service, index);
                    break;
                case 'fileshare':
                    cardContent = createFileshareCard(service, index);
                    break;
                default:
                    cardContent = createUrlCard(service, index);
            }
            
            card.innerHTML = cardContent;
            
            // Add click handler for URL type only
            if (service.type === 'url') {
                card.addEventListener('click', (e) => {
                    if (!card.classList.contains('dragging')) {
                        let url = service.url;
                        if (!url.startsWith('http://') && !url.startsWith('https://')) {
                            url = 'http://' + url;
                        }
                        window.open(url, '_blank');
                    }
                });
            }
            
            return card;
        }

        function createUrlCard(service, index) {
            const isHidden = isCardHidden(index);
            return `
                <div class="service-header">
                    <div class="service-top-row">
                        <div class="service-title-url">
                            <h3><i class="${service.icon || serviceIcons[service.type] || 'fas fa-cube'}"></i> ${service.name}</h3>

                            <!-- <div class="service-type-badge url">URL</div> -->
                        </div>
                        <button class="action-btn toggle-visibility" onclick="toggleCardVisibility(event, ${index})" title="${isHidden ? 'Show' : 'Hide'}">
                            <i class="fas fa-eye${isHidden ? '-slash' : ''}"></i>
                        </button>
                        ${isAdminMode ? `<div class="service-actions">
                            <button class="action-btn edit" onclick="editService(event, ${index})" title="Edit">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn delete" onclick="deleteService(event, ${index})" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>` : ''}
                    </div>
                </div>
                <div class="card-content" data-card-index="${index}" style="display: ${isHidden ? 'none' : 'block'}">
                    ${service.description ? `<div class="service-info"><p>${service.description}</p></div>` : ''}
                    <div class="service-info"><p style="font-family: monospace; color: var(--url-color);">${service.url}</p></div>
                </div>
            `;
        }

        function createSearchCard(service, index) {
            const isHidden = isCardHidden(index);
            return `
                <div class="service-header">
                    <div class="service-top-row">
                        <div class="service-title-url">
                            <h3><i class="${service.icon || serviceIcons[service.type] || 'fas fa-cube'}"></i> ${service.name}</h3>

                            <!--<div class="service-type-badge search">SEARCH</div> -->
                        </div>
                        <button class="action-btn toggle-visibility" onclick="toggleCardVisibility(event, ${index})" title="${isHidden ? 'Show' : 'Hide'}">
                            <i class="fas fa-eye${isHidden ? '-slash' : ''}"></i>
                        </button>
                        ${isAdminMode ? `<div class="service-actions">
                            <button class="action-btn edit" onclick="editService(event, ${index})" title="Edit">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn delete" onclick="deleteService(event, ${index})" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>` : ''}
                    </div>
                </div>
                <div class="card-content" data-card-index="${index}" style="display: ${isHidden ? 'none' : 'block'}">
                    ${service.description ? `<div class="service-info"><p>${service.description}</p></div>` : ''}
                    <input type="text" class="search-box" placeholder="Search..."
                           onkeypress="handleSearch(event, '${service.search_url}')"
                           onclick="event.stopPropagation()">
                </div>
            `;
        }

        function createNotesCard(service, index) {
            const isHidden = isCardHidden(index);
            return `
                <div class="service-header">
                    <div class="service-top-row">
                        <div class="service-title-url">
                            <h3><i class="${service.icon || serviceIcons[service.type] || 'fas fa-cube'}"></i> ${service.name}</h3>
                            <!-- <div class="service-type-badge notes">NOTES</div>-->
                        </div>
                        <button class="action-btn toggle-visibility" onclick="toggleCardVisibility(event, ${index})" title="${isHidden ? 'Show' : 'Hide'}">
                            <i class="fas fa-eye${isHidden ? '-slash' : ''}"></i>
                        </button>
                        ${isAdminMode ? `<div class="service-actions">
                            <button class="action-btn edit" onclick="editService(event, ${index})" title="Edit">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn delete" onclick="deleteService(event, ${index})" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>` : ''}
                    </div>
                </div>
                <div class="card-content" data-card-index="${index}" style="display: ${isHidden ? 'none' : 'block'}">
                    ${service.description ? `<div class="service-info"><p>${service.description}</p></div>` : ''}
                    <div class="notes-content">${(service.notes_content || '').replace(/\n/g, '<br>')}</div>
                </div>
            `;
        }

        function createQuoteCard(service, index) {
    const isHidden = isCardHidden(index);
    return `
        <div class="service-header">
            <div class="service-top-row">
                <div class="service-title-url">
                    <h3>
                        <i class="${service.icon || serviceIcons[service.type] || 'fas fa-cube'}"></i> ${service.name}
                    </h3>
                    <!--<div class="service-type-badge quote">QUOTE</div>-->
                </div>
                <button class="action-btn toggle-visibility" onclick="toggleCardVisibility(event, ${index})" title="${isHidden ? 'Show' : 'Hide'}">
                    <i class="fas fa-eye${isHidden ? '-slash' : ''}"></i>
                </button>
                ${isAdminMode ? `<div class="service-actions">
                    <button class="action-btn edit" onclick="editService(event, ${index})" title="Edit">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="action-btn delete" onclick="deleteService(event, ${index})" title="Delete">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>` : ''}
            </div>
        </div>
        <div class="card-content" data-card-index="${index}" style="display: ${isHidden ? 'none' : 'block'}">
            ${service.description ? `<div class="service-info"><p>${service.description}</p></div>` : ''}

            <div class="quote-content" id="quote-${index}">
                <div class="quote-text" style="
                    white-space: pre-wrap;       /* preserves line breaks and wraps text */
                    overflow-wrap: break-word;   /* wrap long words */
                    word-break: break-word;      /* wrap long words */
                ">
                    Loading quote...
                </div>
                <div class="quote-author"></div>
            </div>

            ${isAdminMode ? `<button onclick="editQuotes()" class="calendar-copy-btn" style="margin-top: 8px; background: linear-gradient(135deg, var(--quote-color) 0%, color-mix(in srgb, var(--quote-color) 100%, #000 40%) 100%);">
                <i class="fas fa-edit"></i> Edit Quotes
            </button>` : ''}
        </div>
    `;
}


        function createCalendarCard(service, index) {
            const today = new Date();
            const day = today.getDate();
            const month = today.getMonth() + 1;
            const year = today.getFullYear();
            const isHidden = isCardHidden(index);

            return `
                <div class="service-header">
                    <div class="service-top-row">
                        <div class="service-title-url">
                            <h3><i class="${service.icon || serviceIcons[service.type] || 'fas fa-cube'}"></i> ${service.name}</h3>
                            <!--<div class="service-type-badge calendar">CALENDAR</div>-->
                        </div>
                        <button class="action-btn toggle-visibility" onclick="toggleCardVisibility(event, ${index})" title="${isHidden ? 'Show' : 'Hide'}">
                            <i class="fas fa-eye${isHidden ? '-slash' : ''}"></i>
                        </button>
                        ${isAdminMode ? `<div class="service-actions">
                            <button class="action-btn edit" onclick="editService(event, ${index})" title="Edit">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn delete" onclick="deleteService(event, ${index})" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>` : ''}
                    </div>
                </div>
                <div class="card-content" data-card-index="${index}" style="display: ${isHidden ? 'none' : 'block'}">
                    ${service.description ? `<div class="service-info"><p>${service.description}</p></div>` : ''}

<div class="calendar-content">

    <!-- Flex container for selects -->
    <div style="
        display: flex;
        gap: 8px;
        justify-content: center;  /* centers all selects horizontally */
        align-items: flex-start;
        flex-wrap: wrap;          /* allows wrapping on small screens */
        margin-bottom: 8px;
    ">
        <select id="day-${index}" onchange="updateCalendarPhrase(event, ${index})" size="${getPhraseCount(month)}" style="width: auto;max-width: 300px;border-radius: 4px;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;">
            ${generateDayOptions(day)}
        </select>

        <select id="month-${index}"  onchange="updateCalendarPhrase(event, ${index})" size="${getPhraseCount(month)}" style="width: auto;max-width: 300px;border-radius: 4px;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;">
            ${generateMonthOptions(month)}
        </select>

        <select id="year-${index}" onchange="updateCalendarPhrase(event, ${index})" size="${getPhraseCount(month)}" style="width: auto;max-width: 300px;border-radius: 4px;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;">
            ${generateYearOptions(year)}
        </select>

        <select id="phrase-${index}" onchange="updateCalendarPhrase(event, ${index})" size="${getPhraseCount(month)}" style="width: auto;min-width: 100px;max-width: 300px;border-radius: 4px;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;">
            ${generatePhraseOptions(month)}
        </select>
    </div>

    <!-- Formatted phrase display -->
<div id="formatted-phrase-${index}" class="calendar-formatted-phrase">
    ${formatCalendarPhrase(day, month, year)}
</div>

    <!-- Copy and Clear buttons -->
    <div style="display: flex; gap: 8px; justify-content: center; margin-top: 8px;">
        <button onclick="clearPhrase(${index})" class="calendar-copy-btn" style="background: linear-gradient(135deg, color-mix(in srgb, var(--calendar-color) 70%, #fff) 0%, color-mix(in srgb, var(--calendar-color) 70%, #000 20%) 100%);">
            <i class="fas fa-times"></i> Clear Phrase
        </button>
        <button onclick="copyToClipboard('formatted-phrase-${index}')" class="calendar-copy-btn">
            <i class="fas fa-copy"></i> Copy to Clipboard
        </button>
    </div>

    ${isAdminMode ? `<button onclick="editCalendarPhrases()" class="calendar-copy-btn" style="margin-top: 8px; background: linear-gradient(135deg, var(--url-color) 0%, color-mix(in srgb, var(--url-color) 100%, #000 40%) 100%);">
        <i class="fas fa-edit"></i> Edit Calendar Phrases
    </button>` : ''}
</div>
                </div>


            `;
        }

        function createIframeCard(service, index) {
            const width = service.iframe_width === 'auto' ? '100%' : service.iframe_width;
            const height = service.iframe_height === 'auto' ? '300px' : service.iframe_height;
            const isHidden = isCardHidden(index);

            return `
                <div class="service-header">
                    <div class="service-top-row">
                        <div class="service-title-url">
                            <h3><i class="${service.icon || serviceIcons[service.type] || 'fas fa-cube'}"></i> ${service.name}</h3>
                            <!--<div class="service-type-badge iframe">IFRAME</div>-->
                        </div>
                        <button class="action-btn toggle-visibility" onclick="toggleCardVisibility(event, ${index})" title="${isHidden ? 'Show' : 'Hide'}">
                            <i class="fas fa-eye${isHidden ? '-slash' : ''}"></i>
                        </button>
                        ${isAdminMode ? `<div class="service-actions">
                            <button class="action-btn edit" onclick="editService(event, ${index})" title="Edit">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn delete" onclick="deleteService(event, ${index})" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>` : ''}
                    </div>
                </div>
                <div class="card-content" data-card-index="${index}" style="display: ${isHidden ? 'none' : 'block'}">
                    ${service.description ? `<div class="service-info"><p>${service.description}</p></div>` : ''}

                    <div style="margin-top: 0.5rem;">
                        <iframe src="${service.iframe_url}"
                                width="${width}"
                                height="${height}"
                                style="border: 1px solid rgba(0,0,0,0.1); border-radius: 8px; max-width: 100%;"
                                frameborder="0"
                                sandbox="allow-same-origin allow-scripts allow-forms allow-popups"
                                referrerpolicy="no-referrer-when-downgrade"
                                allowfullscreen>
                        </iframe>
					<!--
					<div style="font-size: 0.75rem; color: #64748b; margin-top: 4px;">
						Note: Some sites may block embedding. <a href="${service.iframe_url}" target="_blank" style="color: #3b82f6;">Open in new tab</a>
					</div>
					-->
                    </div>
                </div>
            `;
        }

        function createSuggestionsCard(service, index) {
            const isHidden = isCardHidden(index);
            return `
                <div class="service-header">
                    <div class="service-top-row">
                        <div class="service-title-url">
                            <h3><i class="${service.icon || serviceIcons[service.type] || 'fas fa-cube'}"></i> ${service.name}</h3>
                        </div>
                        <button class="action-btn toggle-visibility" onclick="toggleCardVisibility(event, ${index})" title="${isHidden ? 'Show' : 'Hide'}">
                            <i class="fas fa-eye${isHidden ? '-slash' : ''}"></i>
                        </button>
                        ${isAdminMode ? `<div class="service-actions">
                            <button class="action-btn edit" onclick="editService(event, ${index})" title="Edit">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn delete" onclick="deleteService(event, ${index})" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>` : ''}
                    </div>
                </div>
                <div class="card-content" data-card-index="${index}" style="display: ${isHidden ? 'none' : 'block'}">
                    ${service.description ? `<div class="service-info"><p>${service.description}</p></div>` : ''}

                    <div class="suggestions-content">
                        <div class="suggestion-input-container">
                            <input type="text"
                                   class="suggestion-input"
                                   id="suggestionInput-${index}"
                                   placeholder="Share your suggestion..."
                                   maxlength="500">
                            <button class="suggestion-submit-btn" onclick="submitSuggestion(event, ${index})">
                                <i class="fas fa-paper-plane"></i> Submit
                            </button>
                        </div>

                        <div class="suggestions-list" id="suggestionsList-${index}">
                            <div class="loading-suggestions">Loading suggestions...</div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Suggestions functions
        async function loadSuggestionsForCard(index) {
            try {
                const response = await fetch('/api/suggestions');
                const data = await response.json();

                if (data.success) {
                    const listContainer = document.getElementById(`suggestionsList-${index}`);
                    if (!listContainer) return;

                    if (data.suggestions.length === 0) {
                        listContainer.innerHTML = '<div class="no-suggestions">No suggestions yet. Be the first to share!</div>';
                        return;
                    }

                    listContainer.innerHTML = data.suggestions.map(suggestion => {
                        const upvotes = suggestion.upvotes || suggestion.votes || 0;
                        const downvotes = suggestion.downvotes || 0;
                        const score = suggestion.score || (upvotes - downvotes);

                        return `
                        <div class="suggestion-item" data-suggestion-id="${suggestion.id}">
                            <div class="suggestion-text" id="suggestion-text-${suggestion.id}">${escapeHtml(suggestion.text)}</div>
                            <div class="suggestion-footer">
                                <span class="suggestion-date">${formatDate(suggestion.created_at)}</span>
                                <span class="suggestion-score ${score < 0 ? 'negative' : ''}">${score > 0 ? '+' : ''}${score}</span>
                                ${isAdminMode ? `
                                    <button class="edit-suggestion-btn" onclick="editSuggestionItem(event, ${suggestion.id}, ${index})" title="Edit">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="delete-suggestion-btn" onclick="deleteSuggestionItem(event, ${suggestion.id}, ${index})" title="Delete">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                ` : ''}
                                <div class="vote-buttons">
                                    <button class="vote-btn upvote"
                                            onclick="voteSuggestion(event, ${suggestion.id}, ${index}, 'up')">
                                        <i class="fas fa-arrow-up"></i>
                                        <span class="vote-count">${upvotes}</span>
                                    </button>
                                    <button class="vote-btn downvote"
                                            onclick="voteSuggestion(event, ${suggestion.id}, ${index}, 'down')">
                                        <i class="fas fa-arrow-down"></i>
                                        <span class="vote-count">${downvotes}</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;}).join('');
                }
            } catch (error) {
                console.error('Error loading suggestions:', error);
                const listContainer = document.getElementById(`suggestionsList-${index}`);
                if (listContainer) {
                    listContainer.innerHTML = '<div class="error-suggestions">Error loading suggestions</div>';
                }
            }
        }

        async function submitSuggestion(event, index) {
            event.stopPropagation();
            const input = document.getElementById(`suggestionInput-${index}`);
            const suggestionText = input.value.trim();

            if (!suggestionText) {
                alert('Please enter a suggestion');
                return;
            }

            try {
                const response = await fetch('/api/suggestions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ suggestion: suggestionText })
                });

                const data = await response.json();

                if (data.success) {
                    input.value = '';
                    await loadSuggestionsForCard(index);
                } else {
                    alert(data.error || 'Failed to submit suggestion');
                }
            } catch (error) {
                console.error('Error submitting suggestion:', error);
                alert('Error submitting suggestion');
            }
        }

        async function voteSuggestion(event, suggestionId, index, voteType) {
            event.stopPropagation();

            try {
                const response = await fetch(`/api/suggestions/${suggestionId}/vote`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ type: voteType })
                });

                const data = await response.json();

                if (data.success) {
                    await loadSuggestionsForCard(index);
                } else {
                    alert(data.error || 'Failed to vote');
                }
            } catch (error) {
                console.error('Error voting:', error);
                alert('Error voting on suggestion');
            }
        }

        async function editSuggestionItem(event, suggestionId, index) {
            event.stopPropagation();

            const textElement = document.getElementById(`suggestion-text-${suggestionId}`);
            const currentText = textElement.textContent;

            const newText = prompt('Edit suggestion:', currentText);

            if (newText === null || newText.trim() === '') {
                return;
            }

            if (newText.trim() === currentText) {
                return; // No changes
            }

            try {
                const response = await fetch(`/api/suggestions/${suggestionId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ text: newText.trim() })
                });

                const data = await response.json();

                if (data.success) {
                    await loadSuggestionsForCard(index);
                } else {
                    alert(data.error || 'Failed to update suggestion');
                }
            } catch (error) {
                console.error('Error editing suggestion:', error);
                alert('Error editing suggestion');
            }
        }

        async function deleteSuggestionItem(event, suggestionId, index) {
            event.stopPropagation();

            if (!confirm('Are you sure you want to delete this suggestion?')) {
                return;
            }

            try {
                const response = await fetch(`/api/suggestions/${suggestionId}`, {
                    method: 'DELETE'
                });

                const data = await response.json();

                if (data.success) {
                    await loadSuggestionsForCard(index);
                } else {
                    alert(data.error || 'Failed to delete suggestion');
                }
            } catch (error) {
                console.error('Error deleting suggestion:', error);
                alert('Error deleting suggestion');
            }
        }

        // Clipboard Card Functions
        function createClipboardCard(service, index) {
            const isHidden = isCardHidden(index);
            let serverUrl = service.clipboard_server_url || 'http://192.168.2.8';
            // Ensure URL has protocol
            if (!serverUrl.startsWith('http://') && !serverUrl.startsWith('https://')) {
                serverUrl = 'http://' + serverUrl;
            }

            return `
                <div class="service-header">
                    <div class="service-top-row">
                        <div class="service-title-url">
                            <h3><i class="${service.icon || serviceIcons[service.type]}"></i> ${service.name}</h3>
                        </div>
                        <button class="action-btn toggle-visibility" onclick="toggleCardVisibility(event, ${index})" title="${isHidden ? 'Show' : 'Hide'}">
                            <i class="fas fa-eye${isHidden ? '-slash' : ''}"></i>
                        </button>
                        ${isAdminMode ? `<div class="service-actions">
                            <button class="action-btn edit" onclick="editService(event, ${index})" title="Edit">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn delete" onclick="deleteService(event, ${index})" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>` : ''}
                    </div>
                </div>
                <div class="card-content" data-card-index="${index}" style="display: ${isHidden ? 'none' : 'block'}">
                    ${service.description ? `<div class="service-info"><p>${service.description}</p></div>` : ''}
                    <div class="clipboard-content">
                        <textarea class="clipboard-textarea" id="clipboardText-${index}" placeholder="Shared clipboard..."></textarea>
                        <div class="clipboard-formatting">
                            <button class="format-btn" onclick="formatClipboardText(${index}, 'upper')">UPPER</button>
                            <button class="format-btn" onclick="formatClipboardText(${index}, 'lower')">lower</button>
                            <button class="format-btn" onclick="formatClipboardText(${index}, 'title')">Title Case</button>
                        </div>
                        <div class="clipboard-actions">
                            <button class="clipboard-btn primary" onclick="copyClipboardText(${index})">
                                <i class="fas fa-copy"></i> Copy
                            </button>
                            <button class="clipboard-btn secondary" onclick="clearClipboardText(${index})">
                                <i class="fas fa-times"></i> Clear
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        let clipboardSockets = {};
        let fileshareSocketsMap = {};

        async function loadClipboardContent(index) {
            const service = services[index];
            let serverUrl = service.clipboard_server_url || 'http://192.168.2.8';
            // Ensure URL has protocol
            if (!serverUrl.startsWith('http://') && !serverUrl.startsWith('https://')) {
                serverUrl = 'http://' + serverUrl;
            }
            const textarea = document.getElementById(`clipboardText-${index}`);

            if (!textarea) return;

            try {
                // Load initial content
                const response = await fetch(`${serverUrl}/shared_text`);
                const data = await response.json();
                textarea.value = data.content || '';

                // Setup Socket.IO for real-time bidirectional sync
                if (!clipboardSockets[index]) {
                    const socket = io(serverUrl);
                    clipboardSockets[index] = socket;

                    // Listen for updates from server
                    socket.on('shared_text_updated', (data) => {
                        const currentTextarea = document.getElementById(`clipboardText-${index}`);
                        if (currentTextarea && document.activeElement !== currentTextarea) {
                            // Only update if user isn't currently typing
                            currentTextarea.value = data.content || '';
                        }
                    });

                    socket.on('connect_error', (error) => {
                        console.error('Socket connection error:', error);
                    });
                }
            } catch (error) {
                console.error('Error loading clipboard:', error);
            }
        }

        async function saveClipboardContent(index) {
            const service = services[index];
            let serverUrl = service.clipboard_server_url || 'http://192.168.2.8';
            // Ensure URL has protocol
            if (!serverUrl.startsWith('http://') && !serverUrl.startsWith('https://')) {
                serverUrl = 'http://' + serverUrl;
            }
            const textarea = document.getElementById(`clipboardText-${index}`);

            try {
                await fetch(`${serverUrl}/shared_text`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ content: textarea.value })
                });
            } catch (error) {
                console.error('Error saving clipboard:', error);
            }
        }

        function copyClipboardText(index) {
            const textarea = document.getElementById(`clipboardText-${index}`);
            textarea.select();
            document.execCommand('copy');
            showAlert('Copied to clipboard!', 'success');
        }

        function clearClipboardText(index) {
            const textarea = document.getElementById(`clipboardText-${index}`);
            textarea.value = '';
            saveClipboardContent(index);
        }

        function formatClipboardText(index, format) {
            const textarea = document.getElementById(`clipboardText-${index}`);
            let text = textarea.value;

            switch (format) {
                case 'upper':
                    text = text.toUpperCase();
                    break;
                case 'lower':
                    text = text.toLowerCase();
                    break;
                case 'title':
                    text = text.replace(/\w\S*/g, (txt) => {
                        return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();
                    });
                    break;
            }

            textarea.value = text;
            saveClipboardContent(index);
        }

        // File Share Card Functions
        function createFileshareCard(service, index) {
            const isHidden = isCardHidden(index);
            let serverUrl = service.fileshare_server_url || 'http://192.168.2.8';
            // Ensure URL has protocol
            if (!serverUrl.startsWith('http://') && !serverUrl.startsWith('https://')) {
                serverUrl = 'http://' + serverUrl;
            }

            return `
                <div class="service-header">
                    <div class="service-top-row">
                        <div class="service-title-url">
                            <h3><i class="${service.icon || serviceIcons[service.type]}"></i> ${service.name}</h3>
                        </div>
                        <button class="action-btn toggle-visibility" onclick="toggleCardVisibility(event, ${index})" title="${isHidden ? 'Show' : 'Hide'}">
                            <i class="fas fa-eye${isHidden ? '-slash' : ''}"></i>
                        </button>
                        ${isAdminMode ? `<div class="service-actions">
                            <button class="action-btn edit" onclick="editService(event, ${index})" title="Edit">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn delete" onclick="deleteService(event, ${index})" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>` : ''}
                    </div>
                </div>
                <div class="card-content" data-card-index="${index}" style="display: ${isHidden ? 'none' : 'block'}">
                    ${service.description ? `<div class="service-info"><p>${service.description}</p></div>` : ''}
                    <div class="fileshare-content">
                        <div class="fileshare-files" id="fileshareList-${index}">
                            <div class="loading-files">Loading files...</div>
                        </div>
                        <div class="fileshare-upload">
                            <input type="file" id="fileInput-${index}" style="display: none;" onchange="uploadFileToNshare(${index})" multiple>
                            <button class="fileshare-btn secondary" onclick="document.getElementById('fileInput-${index}').click()">
                                <i class="fas fa-upload"></i> Upload Files
                            </button>
                            <a href="${serverUrl}" target="_blank" class="fileshare-btn primary">
                                <i class="fas fa-folder-open"></i> Browse Files
                            </a>
                        </div>
                    </div>
                </div>
            `;
        }

        async function uploadFileToNshare(index) {
            const service = services[index];
            let serverUrl = service.fileshare_server_url || 'http://192.168.2.8';
            // Ensure URL has protocol
            if (!serverUrl.startsWith('http://') && !serverUrl.startsWith('https://')) {
                serverUrl = 'http://' + serverUrl;
            }
            const fileInput = document.getElementById(`fileInput-${index}`);
            const files = fileInput.files;

            if (!files || files.length === 0) return;

            try {
                const formData = new FormData();
                for (let i = 0; i < files.length; i++) {
                    formData.append('files', files[i]);
                }

                const response = await fetch(`${serverUrl}/upload`, {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (data.success) {
                    fileInput.value = '';
                    // File list will update automatically via Socket.IO
                } else {
                    alert('Upload failed');
                }
            } catch (error) {
                console.error('Error uploading files:', error);
                alert('Error uploading files');
            }
        }

        async function loadFileshareContent(index) {
            const service = services[index];
            let serverUrl = service.fileshare_server_url || 'http://192.168.2.8';
            // Ensure URL has protocol
            if (!serverUrl.startsWith('http://') && !serverUrl.startsWith('https://')) {
                serverUrl = 'http://' + serverUrl;
            }
            const maxFiles = service.fileshare_max_files || 5;
            const listContainer = document.getElementById(`fileshareList-${index}`);

            if (!listContainer) return;

            // Function to update file list
            const updateFileList = async () => {
                try {
                    const response = await fetch(`${serverUrl}/api/files?limit=${maxFiles}`);
                    const data = await response.json();

                    if (data.success && data.files && data.files.length > 0) {
                        const baseUrl = data.base_url || serverUrl;
                        listContainer.innerHTML = data.files.map(file => {
                            const downloadUrl = file.is_dir
                                ? `${baseUrl}?path=${encodeURIComponent(file.path)}`
                                : `${baseUrl}/download?path=${encodeURIComponent(file.path)}`;

                            return `
                                <a href="${downloadUrl}" class="fileshare-file-item" ${file.is_dir ? '' : 'download'} target="_blank">
                                    <i class="${file.icon} fileshare-file-icon"></i>
                                    <div class="fileshare-file-info">
                                        <div class="fileshare-file-name">${escapeHtml(file.name)}</div>
                                        <div class="fileshare-file-meta">
                                            ${file.is_dir ? '<span>Folder</span>' : `<span>${file.size_formatted}</span>`}
                                            <span>${file.modified}</span>
                                        </div>
                                    </div>
                                </a>
                            `;
                        }).join('');
                    } else {
                        listContainer.innerHTML = '<div class="no-files">No files available</div>';
                    }
                } catch (error) {
                    console.error('Error loading files:', error);
                    listContainer.innerHTML = '<div class="error-files">Error loading files</div>';
                }
            };

            // Initial load
            await updateFileList();

            // Setup Socket.IO for real-time updates
            if (!fileshareSocketsMap[index]) {
                const socket = io(serverUrl);
                fileshareSocketsMap[index] = socket;

                // Listen for file updates from server
                socket.on('file_updated', (data) => {
                    // Reload file list when files change
                    updateFileList();
                });

                socket.on('connect_error', (error) => {
                    console.error('Socket connection error:', error);
                });
            }
        }

        function getUserIP() {
            // This is a placeholder - the actual IP checking is done server-side
            return 'client';
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMins / 60);
            const diffDays = Math.floor(diffHours / 24);

            if (diffMins < 1) return 'just now';
            if (diffMins < 60) return `${diffMins}m ago`;
            if (diffHours < 24) return `${diffHours}h ago`;
            if (diffDays < 7) return `${diffDays}d ago`;
            return date.toLocaleDateString();
        }


function showIconPicker() {
    document.getElementById('iconPickerModal').classList.add('show');

    // Add specific event prevention for this modal (backup method)
    setTimeout(() => {
        const modalContent = document.querySelector('#iconPickerModal .modal-content');
        if (modalContent) {
            modalContent.addEventListener('click', function(e) {
                e.stopPropagation();
            });
        }

        // Add click handlers to all icon options
        const iconOptions = document.querySelectorAll('#iconPickerModal .icon-option');
        iconOptions.forEach(option => {
            option.onclick = function(e) {
                e.stopPropagation();
                const iconClass = this.getAttribute('data-icon');
                document.getElementById('serviceIcon').value = iconClass;
                hideIconPicker();
            };
        });
    }, 100);
}

function hideIconPicker() {
    document.getElementById('iconPickerModal').classList.remove('show');
}






function getPhraseCount(monthNumber) {
    if (!calendarConfig.months || !calendarConfig.months[monthNumber]) return 3;
    const phrases = calendarConfig.months[monthNumber].phrases || [];
    return Math.max(3, phrases.length);
}

		function generateDayOptions(selectedDay) {
			let options = '';
			for (let i = 1; i <= 31; i++) {
				options += `<option value="${i}" ${i === selectedDay ? 'selected' : ''}>${i}</option>`;
			}
			return options;
		}
		
		function generateYearOptions(selectedYear) {
			const currentYear = new Date().getFullYear();
			const years = [currentYear - 1, currentYear, currentYear + 1];
			
			return years.map(year => 
				`<option value="${year}" ${year === selectedYear ? 'selected' : ''}>${year}</option>`
			).join('');
		}


        // Helper functions for calendar
        function generateMonthOptions(selectedMonth) {
			const defaultMonthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
			const monthNames = calendarConfig.monthNames || defaultMonthNames;

			const months = monthNames.map((name, index) => ({
				value: index + 1,
				name: name
			}));

            return months.map(month =>
                `<option value="${month.value}" ${month.value === selectedMonth ? 'selected' : ''}>${month.name}</option>`
            ).join('');
        }

		function generatePhraseOptions(monthNumber) {
			if (!calendarConfig.months || !calendarConfig.months[monthNumber.toString()]) {
				return '<option value="">No phrases available</option>';
			}
			
			const phrases = calendarConfig.months[monthNumber.toString()].phrases || [];
			if (phrases.length === 0) {
				return '<option value="">No phrases available</option>';
			}
			
			return phrases.map(phrase => `<option value="${phrase}">${phrase}</option>`).join('');
		}

		function getMonthName(monthNumber) {
			const defaultMonthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
			const monthNames = calendarConfig.monthNames || defaultMonthNames;
			return monthNames[monthNumber - 1] || monthNumber;
		}

		function formatCalendarPhrase(day, month, year, phrase = '') {
			const defaultFormat = '{month} {day}, {year} - {phrase}';
			let format = calendarConfig.format || defaultFormat;
			const monthName = getMonthName(parseInt(month));

			// If no phrase, remove the {phrase} placeholder and adjacent separators
			if (!phrase) {
				// Remove separator before {phrase}: " - {phrase}" or "{phrase} - "
				format = format
					.replace(/\s*[-:;,|\/\\]\s*\{phrase\}\s*[-:;,|\/\\]?\s*/g, ' ')
					.replace(/\{phrase\}\s*[-:;,|\/\\]\s*/g, '')
					.replace(/\s*[-:;,|\/\\]\s*\{phrase\}/g, '');
			}

			let result = format
				.replace('{month}', monthName)
				.replace('{day}', day)
				.replace('{year}', year)
				.replace('{phrase}', phrase);

			return result.trim().replace(/\s+/g, ' ');
		}

async function updateCalendarPhrase(event, index) {
    const day = document.getElementById(`day-${index}`).value;
    const month = document.getElementById(`month-${index}`).value;
    const year = document.getElementById(`year-${index}`).value;
    const phrase = document.getElementById(`phrase-${index}`).value || '';

    try {
        const formattedPhrase = formatCalendarPhrase(day, month, year, phrase);
        document.getElementById(`formatted-phrase-${index}`).textContent = formattedPhrase;

        // Update phrase options when month changes
        if (event && event.target && event.target.id.includes('month-')) {
            const phraseSelect = document.getElementById(`phrase-${index}`);
            const daySelect = document.getElementById(`day-${index}`);
            const yearSelect = document.getElementById(`year-${index}`);

            const newOptions = generatePhraseOptions(parseInt(month));
            const newSize = getPhraseCount(parseInt(month));

            phraseSelect.innerHTML = newOptions;
            phraseSelect.setAttribute('size', newSize);
            daySelect.setAttribute('size', newSize);
            yearSelect.setAttribute('size', newSize);

            // Clear selection and update display without phrase
            phraseSelect.value = '';
            updateCalendarPhrase(null, index);
        }
    } catch (error) {
        //console.error('Failed to update calendar phrase:', error);
    }
}

function clearPhrase(index) {
    const phraseSelect = document.getElementById(`phrase-${index}`);
    phraseSelect.value = '';
    updateCalendarPhrase(null, index);
}

async function copyToClipboard(elementId) {
    const element = document.getElementById(elementId);
    const text = element.textContent.trim(); // Remove leading/trailing spaces
    
    try {
        if (navigator.clipboard && navigator.clipboard.writeText) {
            await navigator.clipboard.writeText(text);
        } else {
            // Fallback for older browsers
            const textArea = document.createElement('textarea');
            textArea.value = text;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
        }
        
        // Visual feedback
        const originalBg = element.style.background;
        element.style.background = 'rgba(34, 197, 94, 0.2)';
        setTimeout(() => {
            element.style.background = originalBg;
        }, 500);
        
        showSuccess('Copied to clipboard!');
    } catch (error) {
        //console.error('Failed to copy to clipboard:', error);
        showError('Failed to copy to clipboard');
    }
}

        // Load quotes for quote cards
        async function loadQuoteForCard(index) {
            try {
                const response = await apiRequest('/api/quote');
                if (response.success) {
                    const quoteElement = document.getElementById(`quote-${index}`);
                    if (quoteElement) {
                        quoteElement.innerHTML = `
                            <div class="quote-text">"${response.quote.text}"</div>
                            <div class="quote-author"> ${response.quote.author}</div>
                        `;
                    }
                }
            } catch (error) {
                //console.error('Failed to load quote:', error);
            }
        }

        // Handle search functionality
        function handleSearch(event, searchUrl) {
            if (event.key === 'Enter') {
                const query = event.target.value.trim();
                if (query) {
                    const url = searchUrl.replace('{query}', encodeURIComponent(query));
                    window.open(url, '_blank');
                }
            }
        }

        // Handle type change in modal
        function handleTypeChange() {
            const serviceType = document.getElementById('serviceType').value;
            
            // Hide all type-specific fields
            document.querySelectorAll('.type-specific-fields').forEach(field => {
                field.classList.remove('show');
            });
            
            // Show relevant fields
            const fieldsId = serviceType + 'Fields';
            const fieldsElement = document.getElementById(fieldsId);
            if (fieldsElement) {
                fieldsElement.classList.add('show');
            }
        }

        // Drag and drop functions (admin only)
        function setupDragAndDrop() {
            if (!isAdminMode) return;
            
            for (let i = 0; i < 3; i++) {
                const column = document.querySelector(`.column[data-column="${i}"]`);
                const servicesList = document.getElementById(`column${i}`);
                
                column.addEventListener('dragover', handleDragOver);
                column.addEventListener('drop', handleDrop);
                column.addEventListener('dragenter', handleDragEnter);
                column.addEventListener('dragleave', handleDragLeave);
                
                servicesList.addEventListener('dragover', handleColumnDragOver);
                servicesList.addEventListener('drop', handleColumnDrop);
            }

            document.addEventListener('dragstart', handleDragStart);
            document.addEventListener('dragend', handleDragEnd);
        }

        function handleDragStart(e) {
            if (!e.target.classList.contains('service-card')) return;
            
            draggedService = e.target;
            e.target.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
        }

        function handleDragEnd(e) {
            if (!e.target.classList.contains('service-card')) return;

            e.target.classList.remove('dragging');
            draggedService = null;

            // Clean up all drag indicators
            document.querySelectorAll('.column').forEach(col => {
                col.classList.remove('drag-over');
            });

            document.querySelectorAll('.service-card.drag-over').forEach(card => {
                card.classList.remove('drag-over');
            });
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
        }

        function handleDragEnter(e) {
            if (e.target.closest('.column')) {
                e.target.closest('.column').classList.add('drag-over');
            }
        }

        function handleDragLeave(e) {
            const column = e.target.closest('.column');
            if (column && !column.contains(e.relatedTarget)) {
                column.classList.remove('drag-over');
            }
        }

        let dragOverElement = null;

        function handleColumnDragOver(e) {
            e.preventDefault();
            if (!draggedService) return;

            const servicesList = e.currentTarget;

            // Remove previous drag-over highlight
            document.querySelectorAll('.service-card.drag-over').forEach(el => {
                el.classList.remove('drag-over');
            });

            // Find where the card would be inserted
            const afterElement = getDragAfterElement(servicesList, e.clientY);

            // Highlight the position where card will land
            if (afterElement) {
                afterElement.classList.add('drag-over');
                dragOverElement = afterElement;
            } else {
                // Will be inserted at the end, highlight the last card
                const cards = servicesList.querySelectorAll('.service-card:not(.dragging)');
                if (cards.length > 0) {
                    const lastCard = cards[cards.length - 1];
                    lastCard.style.borderBottom = '3px solid var(--url-color)';
                    setTimeout(() => {
                        lastCard.style.borderBottom = '';
                    }, 100);
                }
            }
        }

        function handleColumnDrop(e) {
            e.preventDefault();
            if (!draggedService) return;

            // Remove all drag-over highlights
            document.querySelectorAll('.service-card.drag-over').forEach(el => {
                el.classList.remove('drag-over');
            });

            const servicesList = e.currentTarget;
            const column = servicesList.closest('.column');
            const newColumn = parseInt(column.dataset.column);
            const serviceIndex = parseInt(draggedService.dataset.serviceIndex);

            // Calculate where to insert in the target column
            const afterElement = getDragAfterElement(servicesList, e.clientY);

            // Insert the dragged element at the correct position
            if (afterElement == null) {
                servicesList.appendChild(draggedService);
            } else {
                servicesList.insertBefore(draggedService, afterElement);
            }

            // Update column and reorder services array based on new DOM order
            services[serviceIndex].column = newColumn;
            reorderServicesArray();

            saveServicesToServer().then(() => {
                renderServices();
            }).catch(() => {
                loadServices();
            });
        }

        async function handleDrop(e) {
            e.preventDefault();
            
            const column = e.target.closest('.column');
            if (!column || !draggedService) return;
            
            const newColumn = parseInt(column.dataset.column);
            const serviceIndex = parseInt(draggedService.dataset.serviceIndex);
            
            services[serviceIndex].column = newColumn;
            
            try {
                await saveServicesToServer();
                renderServices();
            } catch (error) {
                loadServices();
            }
            
            column.classList.remove('drag-over');
        }

        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.service-card:not(.dragging)')];
            
            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        function reorderServicesArray() {
            const newServices = [];
            
            for (let col = 0; col < 3; col++) {
                const columnElement = document.getElementById(`column${col}`);
                const cards = columnElement.querySelectorAll('.service-card');
                
                cards.forEach(card => {
                    const index = parseInt(card.dataset.serviceIndex);
                    const service = { ...services[index] };
                    service.column = col;
                    newServices.push(service);
                });
            }
            
            services = newServices;
        }
		
        // Modal and service management functions
        function showAddModal() {
            editingIndex = -1;
            document.getElementById('modalTitle').textContent = 'Add Tile';
            
            // Reset form
            document.getElementById('serviceName').value = '';
            document.getElementById('serviceDescription').value = '';
            document.getElementById('serviceType').value = 'url';
            document.getElementById('serviceColumn').value = '0';
			document.getElementById('serviceIcon').value = '';
            
            // Reset type-specific fields
            document.getElementById('serviceUrl').value = '';
            document.getElementById('searchUrl').value = '';
            document.getElementById('notesContent').value = '';
            document.getElementById('iframeUrl').value = '';
            document.getElementById('iframeWidth').value = 'auto';
            document.getElementById('iframeHeight').value = 'auto';
            
            handleTypeChange();
            document.getElementById('serviceModal').classList.add('show');
            
            // Add specific event prevention for this modal (backup method)
            setTimeout(() => {
                const modalContent = document.querySelector('#serviceModal .modal-content');
                if (modalContent) {
                    modalContent.addEventListener('click', function(e) {
                        e.stopPropagation();
                    });
                }
            }, 100);
        }

        function editService(event, index) {
            event.stopPropagation();
            editingIndex = index;
            const service = services[index];
            
            document.getElementById('modalTitle').textContent = 'Edit Tile';
            document.getElementById('serviceName').value = service.name;
            document.getElementById('serviceDescription').value = service.description || '';
            document.getElementById('serviceType').value = service.type;
            document.getElementById('serviceColumn').value = service.column || 0;
			document.getElementById('serviceIcon').value = service.icon || '';
            
            // Populate type-specific fields
            switch (service.type) {
                case 'url':
                    document.getElementById('serviceUrl').value = service.url || '';
                    break;
                case 'search':
                    document.getElementById('searchUrl').value = service.search_url || '';
                    break;
                case 'notes':
                    document.getElementById('notesContent').value = service.notes_content || '';
                    break;
                case 'iframe':
                    document.getElementById('iframeUrl').value = service.iframe_url || '';
                    document.getElementById('iframeWidth').value = service.iframe_width || 'auto';
                    document.getElementById('iframeHeight').value = service.iframe_height || 'auto';
                    break;
                case 'clipboard':
                    document.getElementById('clipboardServerUrl').value = service.clipboard_server_url || 'http://192.168.2.8';
                    break;
                case 'fileshare':
                    document.getElementById('fileshareServerUrl').value = service.fileshare_server_url || 'http://192.168.2.8';
                    document.getElementById('fileshareMaxFiles').value = service.fileshare_max_files || 5;
                    break;
            }

            handleTypeChange();
            document.getElementById('serviceModal').classList.add('show');
        }

        async function deleteService(event, index) {
            event.stopPropagation();
            if (confirm('Are you sure you want to delete this tile?')) {
                services.splice(index, 1);
                try {
                    await saveServicesToServer();
                    renderServices();
                } catch (error) {
                    loadServices();
                }
            }
        }

        async function saveService() {
            const name = document.getElementById('serviceName').value.trim();
            const description = document.getElementById('serviceDescription').value.trim();
            const type = document.getElementById('serviceType').value;
            const column = parseInt(document.getElementById('serviceColumn').value);


            if (!name) {
                alert('Please fill in the tile name.');
                return;
            }

            const service = { name, description, type, column };
			const icon = document.getElementById('serviceIcon').value.trim();
			if (icon) service.icon = icon;

            // Add type-specific data
            switch (type) {
                case 'url':
                    const url = document.getElementById('serviceUrl').value.trim();
                    if (!url) {
                        alert('Please fill in the URL.');
                        return;
                    }
                    service.url = url;
                    break;
                case 'search':
                    const searchUrl = document.getElementById('searchUrl').value.trim();
                    if (!searchUrl) {
                        alert('Please fill in the search URL template.');
                        return;
                    }
                    service.search_url = searchUrl;
                    break;
                case 'notes':
                    service.notes_content = document.getElementById('notesContent').value.trim();
                    break;
                case 'iframe':
                    const iframeUrl = document.getElementById('iframeUrl').value.trim();
                    if (!iframeUrl) {
                        alert('Please fill in the iframe URL.');
                        return;
                    }
                    service.iframe_url = iframeUrl;
                    service.iframe_width = document.getElementById('iframeWidth').value;
                    service.iframe_height = document.getElementById('iframeHeight').value;
                    break;
                case 'clipboard':
                    let clipboardServerUrl = document.getElementById('clipboardServerUrl').value.trim();
                    if (!clipboardServerUrl) {
                        alert('Please fill in the NShare server URL.');
                        return;
                    }
                    // Ensure URL has protocol
                    if (!clipboardServerUrl.startsWith('http://') && !clipboardServerUrl.startsWith('https://')) {
                        clipboardServerUrl = 'http://' + clipboardServerUrl;
                    }
                    service.clipboard_server_url = clipboardServerUrl;
                    break;
                case 'fileshare':
                    let fileshareServerUrl = document.getElementById('fileshareServerUrl').value.trim();
                    if (!fileshareServerUrl) {
                        alert('Please fill in the NShare server URL.');
                        return;
                    }
                    // Ensure URL has protocol
                    if (!fileshareServerUrl.startsWith('http://') && !fileshareServerUrl.startsWith('https://')) {
                        fileshareServerUrl = 'http://' + fileshareServerUrl;
                    }
                    service.fileshare_server_url = fileshareServerUrl;
                    service.fileshare_max_files = parseInt(document.getElementById('fileshareMaxFiles').value) || 5;
                    break;
            }

            if (editingIndex >= 0) {
                services[editingIndex] = service;
            } else {
                services.push(service);
            }

            try {
                await saveServicesToServer();
                renderServices();
                hideModal();
            } catch (error) {
                // Error already shown
            }
        }

        function hideModal() {
            document.getElementById('serviceModal').classList.remove('show');
        }

        async function saveCurrentVisibilityAsDefault() {
            if (confirm('Save the current card visibility state as default for new users?')) {
                try {
                    const currentVisibility = getCardVisibilityState();

                    const response = await apiRequest('/api/default-visibility', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ visibility: currentVisibility })
                    });

                    if (response.success) {
                        alert('Default visibility settings saved successfully!');
                    } else {
                        showError(response.error || 'Failed to save default visibility');
                    }
                } catch (error) {
                    showError('Failed to save default visibility');
                }
            }
        }

        async function nukeAllCookies() {
            if (confirm(' WARNING \n\nThis will immediately clear ALL cookies and local storage for EVERYONE on the site!\n\nThis includes:\n- Theme settings\n- Card visibility preferences\n- Any saved preferences\n\nAll users will be reset to defaults.\n\nAre you ABSOLUTELY sure you want to do this?')) {
                if (confirm('Last chance! This action cannot be undone.\n\nClick OK to nuke all cookies and local storage.')) {
                    try {
                        const response = await apiRequest('/api/nuke-cookies', {
                            method: 'POST'
                        });

                        if (response.success) {
                            alert(' Successfully nuked all cookies!\n\nTimestamp: ' + response.timestamp + '\n\nAll users will have their cookies cleared on next page load.');
                        } else {
                            showError(response.error || 'Failed to nuke cookies');
                        }
                    } catch (error) {
                        showError('Failed to nuke cookies: ' + error.message);
                    }
                }
            }
        }

        async function nukeVisibilitySettings() {
            if (confirm(' WARNING \n\nThis will reset ALL users\' card visibility settings to server defaults!\n\nAll users will have their hidden/shown card preferences cleared.\n\nAre you sure you want to do this?')) {
                try {
                    const response = await apiRequest('/api/nuke-visibility', {
                        method: 'POST'
                    });

                    if (response.success) {
                        alert(' Successfully nuked visibility settings!\n\nTimestamp: ' + response.timestamp + '\n\nAll users will have their visibility settings reset to defaults on next page load.');
                    } else {
                        showError(response.error || 'Failed to nuke visibility settings');
                    }
                } catch (error) {
                    showError('Failed to nuke visibility settings: ' + error.message);
                }
            }
        }

        async function adminLogout() {
            if (confirm('Are you sure you want to logout from admin panel?')) {
                try {
                    await apiRequest('/admin/logout', { method: 'POST' });
                    window.location.href = '/';
                } catch (error) {
                    showError('Failed to logout');
                }
            }
        }

        // Export/Import functions
        async function exportServices() {
            try {
                const exportData = {
                    services: services,
                    calendarConfig: calendarConfig,
                    exportDate: new Date().toISOString()
                };
                
                const data = JSON.stringify(exportData, null, 2);
                const blob = new Blob([data], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'dashboard-export.json';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            } catch (error) {
                showError('Failed to export data');
            }
        }

        function importServices() {
            document.getElementById('fileInput').click();
        }

        async function handleImport(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = async function(e) {
                try {
                    const imported = JSON.parse(e.target.result);
                    
                    if (imported.services && Array.isArray(imported.services)) {
                        services = imported.services.map(service => ({
                            ...service,
                            column: service.column || 0,
                            type: service.type || 'url'
                        }));
                        
                        await saveServicesToServer();
                        
                        if (imported.calendarConfig) {
                            calendarConfig = imported.calendarConfig;
                            await apiRequest('/api/calendar-config', {
                                method: 'POST',
                                body: JSON.stringify({ config: calendarConfig })
                            });
                        }
                        
                        renderServices();
                        showSuccess('Data imported successfully!');
                    } else {
                        alert('Invalid file format. Please select a valid export file.');
                    }
                } catch (error) {
                    alert('Error reading file. Please select a valid JSON file.');
                }
            };
            reader.readAsText(file);
        }

        // Calendar Phrases Editor
        function editCalendarPhrases() {
            const editor = document.getElementById('calendarPhrasesEditor');
            const defaultMonthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                                      'July', 'August', 'September', 'October', 'November', 'December'];

            // Get current format settings or use defaults
            const currentFormat = calendarConfig.format || '{month} {day}, {year} - {phrase}';
            const currentMonthNames = calendarConfig.monthNames || defaultMonthNames;

            let html = '<div style="display: flex; flex-direction: column; gap: 1rem;">';

            // Format Settings Section
            html += `
                <div style="border: 2px solid var(--calendar-color); border-radius: 6px; padding: 0.75rem; background: color-mix(in srgb, var(--calendar-color) 5%, transparent);">
                    <h3 style="margin: 0 0 0.5rem 0; color: var(--calendar-color); font-size: 1rem;">Calendar Settings</h3>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem;">
                        <div>
                            <label style="font-weight: 600; margin-bottom: 0.25rem; display: block; font-size: 0.85rem;">Output Format</label>
                            <input type="text" id="calendarFormat" value="${currentFormat}" placeholder="{month} {day}, {year} - {phrase}" style="width: 100%; padding: 6px; border: 1px solid var(--card-border); border-radius: 4px; background: transparent; color: var(--text-primary); font-family: monospace; font-size: 0.85rem;">
                            <p style="font-size: 0.7rem; color: color-mix(in srgb, var(--text-primary) 60%, transparent); margin: 0.2rem 0 0 0;">
                                Use: {month}, {day}, {year}, {phrase}
                            </p>
                        </div>

                        <div>
                            <label style="font-weight: 600; margin-bottom: 0.25rem; display: block; font-size: 0.85rem;">Month Names (comma-separated)</label>
                            <input type="text" id="monthNames" value="${currentMonthNames.join(', ')}" style="width: 100%; padding: 6px; border: 1px solid var(--card-border); border-radius: 4px; background: transparent; color: var(--text-primary); font-size: 0.85rem;">
                            <p style="font-size: 0.7rem; color: color-mix(in srgb, var(--text-primary) 60%, transparent); margin: 0.2rem 0 0 0;">
                                12 month names for different languages
                            </p>
                        </div>
                    </div>
                </div>
            `;

            // Month Phrases Sections - 5 columns with buttons in remaining grid space
            html += `
                <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 0.5rem;">
            `;

            defaultMonthNames.forEach((defaultName, index) => {
                const monthNum = (index + 1).toString();
                const monthData = calendarConfig.months?.[monthNum] || { name: defaultName, phrases: [] };
                const phrases = monthData.phrases || [];
                const displayName = currentMonthNames[index] || defaultName;

                html += `
                    <div style="border: 1px solid var(--card-border); border-radius: 4px; padding: 0.5rem;">
                        <h4 style="margin: 0 0 0.4rem 0; color: var(--calendar-color); font-size: 0.85rem;">${displayName}</h4>
                        <textarea id="phrases-${monthNum}" rows="5" style="width: 100%; padding: 4px; border: 1px solid var(--card-border); border-radius: 4px; background: transparent; color: var(--text-primary); font-family: inherit; font-size: 0.8rem; resize: vertical;">${phrases.join('\n')}</textarea>
                    </div>
                `;
            });

            // Add buttons in remaining grid cells
            html += `
                <div style="display: flex; flex-direction: column; gap: 0.5rem; justify-content: flex-end;">
                    <button class="btn btn-primary" onclick="saveCalendarPhrases()" style="width: 100%; padding: 0.75rem; background: linear-gradient(135deg, var(--calendar-color) 0%, color-mix(in srgb, var(--calendar-color) 100%, #000 20%) 100%); color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600;">
                        <i class="fas fa-save"></i> Save
                    </button>
                    <button class="btn btn-secondary" onclick="hideCalendarPhrasesModal()" style="width: 100%; padding: 0.75rem; background: color-mix(in srgb, var(--text-secondary) 20%, transparent); color: var(--text-primary); border: 1px solid var(--card-border); border-radius: 4px; cursor: pointer;">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                </div>
            `;

            html += '</div></div>';
            editor.innerHTML = html;
            document.getElementById('calendarPhrasesModal').classList.add('show');
        }

        function hideCalendarPhrasesModal() {
            document.getElementById('calendarPhrasesModal').classList.remove('show');
        }

        async function saveCalendarPhrases() {
            const months = {};
            const defaultMonthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                                      'July', 'August', 'September', 'October', 'November', 'December'];

            // Get format settings
            const formatInput = document.getElementById('calendarFormat');
            const monthNamesInput = document.getElementById('monthNames');

            const customFormat = formatInput.value.trim() || '{month} {day}, {year} - {phrase}';
            const customMonthNames = monthNamesInput.value.split(',').map(m => m.trim()).filter(m => m !== '');

            // Validate month names (should be 12)
            if (customMonthNames.length !== 12) {
                showError('Please provide exactly 12 month names separated by commas');
                return;
            }

            // Save format and month names to config
            calendarConfig.format = customFormat;
            calendarConfig.monthNames = customMonthNames;

            customMonthNames.forEach((monthName, index) => {
                const monthNum = (index + 1).toString();
                const textarea = document.getElementById(`phrases-${monthNum}`);
                const phrases = textarea.value.split('\n').filter(p => p.trim() !== '');

                months[monthNum] = {
                    name: monthName,
                    phrases: phrases
                };
            });

            calendarConfig.months = months;

            try {
                await apiRequest('/api/calendar-config', {
                    method: 'POST',
                    body: JSON.stringify({ config: calendarConfig })
                });

                hideCalendarPhrasesModal();
                renderServices();
                showSuccess('Calendar settings saved successfully!');
            } catch (error) {
                showError('Failed to save calendar settings');
            }
        }

        // Quotes Editor
        function editQuotes() {
            const editor = document.getElementById('quotesEditor');
            const quotes = calendarConfig.quotes || [];

            // Convert quotes to notepad format: "quote text" - Author
            const quotesText = quotes.map(q => `"${q.text}" - ${q.author}`).join('\n\n');

            let html = `
                <div style="display: flex; flex-direction: column; gap: 1rem;">
                    <p style="color: color-mix(in srgb, var(--text-primary) 70%, transparent); font-size: 0.875rem; margin: 0;">
                        Format: <code style="background: color-mix(in srgb, var(--text-primary) 10%, transparent); padding: 2px 6px; border-radius: 4px;">"Quote text" - Author</code>
                        <br>Separate each quote with a blank line.
                    </p>
                    <textarea id="quotesTextarea" rows="20" style="width: 100%; padding: 12px; border: 1px solid var(--card-border); border-radius: 8px; background: transparent; color: var(--text-primary); font-family: 'Courier New', monospace; font-size: 0.9rem; line-height: 1.6; resize: vertical;">${quotesText}</textarea>
                </div>
            `;

            editor.innerHTML = html;
            document.getElementById('quotesModal').classList.add('show');
        }

        function hideQuotesModal() {
            document.getElementById('quotesModal').classList.remove('show');
        }

        async function saveQuotes() {
            const quotesTextarea = document.getElementById('quotesTextarea');
            const quotesText = quotesTextarea.value;
            const quotes = [];

            // Split by double newlines (blank lines) to get individual quotes
            const quoteBlocks = quotesText.split(/\n\s*\n/).filter(block => block.trim());

            quoteBlocks.forEach(block => {
                // Match pattern: "quote text" - Author
                const match = block.trim().match(/^"(.+?)"\s*-\s*(.+)$/s);
                if (match) {
                    const text = match[1].trim();
                    const author = match[2].trim();
                    if (text && author) {
                        quotes.push({ text, author });
                    }
                }
            });

            if (quotes.length === 0) {
                showError('No valid quotes found. Please use format: "Quote text" - Author');
                return;
            }

            calendarConfig.quotes = quotes;

            try {
                await apiRequest('/api/calendar-config', {
                    method: 'POST',
                    body: JSON.stringify({ config: calendarConfig })
                });

                hideQuotesModal();
                renderServices();
                showSuccess(`${quotes.length} quote(s) saved successfully!`);
            } catch (error) {
                showError('Failed to save quotes');
            }
        }

        // Site Title Editor
        function editSiteTitle() {
            const currentTitle = document.getElementById('siteTitle').textContent;
            const newTitle = prompt('Enter new site title:', currentTitle);

            if (newTitle !== null && newTitle.trim() !== '') {
                saveSiteTitle(newTitle.trim());
            }
        }

        async function saveSiteTitle(title) {
            try {
                calendarConfig.siteTitle = title;

                await apiRequest('/api/calendar-config', {
                    method: 'POST',
                    body: JSON.stringify({ config: calendarConfig })
                });

                document.getElementById('siteTitle').textContent = title;
                document.getElementById('pageTitle').textContent = title + ' Homepage';
                showSuccess('Site title updated successfully!');
            } catch (error) {
                showError('Failed to save site title');
            }
        }

        // Utility functions
        function showLoading(show) {
            document.getElementById('loadingState').style.display = show ? 'block' : 'none';
        }

        function showError(message) {
            document.querySelectorAll('.error-message').forEach(el => el.remove());
            
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.innerHTML = `<i class="fas fa-exclamation-triangle"></i> ${message}`;
            
            document.querySelector('.container').insertBefore(errorDiv, document.querySelector('.columns-container'));
            
            setTimeout(() => {
                if (errorDiv.parentNode) {
                    errorDiv.remove();
                }
            }, 5000);
        }

        function showSuccess(message) {
            document.querySelectorAll('.success-message, .error-message').forEach(el => el.remove());
            
            const successDiv = document.createElement('div');
            successDiv.className = 'success-message';
            successDiv.style.cssText = `
                background: rgba(34, 197, 94, 0.1);
                border: 1px solid rgba(34, 197, 94, 0.3);
                border-radius: 12px;
                padding: 1rem;
                margin: 1rem 0;
                color: #15803d;
            `;
            successDiv.innerHTML = `<i class="fas fa-check-circle"></i> ${message}`;
            
            document.querySelector('.container').insertBefore(successDiv, document.querySelector('.columns-container'));
            
            setTimeout(() => {
                if (successDiv.parentNode) {
                    successDiv.remove();
                }
            }, 3000);
        }


        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                hideModal();
                hideIconPicker();
            } else if (isAdminMode && e.ctrlKey && e.key === 'n') {
                e.preventDefault();
                showAddModal();
            }
        });

        // Color Themes
        const colorThemes = {
            light: {
                name: 'Light',
                bg: ['#ffffff', '#f9fafb', '#f3f4f6', '#e5e7eb'],
                text: '#111827',
                textSecondary: '#4b5563',
                card: 'rgba(255, 255, 255, 0.9)',
                cardBorder: 'rgba(229, 231, 235, 0.8)',
                cardShadow: 'rgba(0, 0, 0, 0.08)',
                orbs: ['rgba(59, 130, 246, 0.1)', 'rgba(139, 92, 246, 0.1)', 'rgba(236, 72, 153, 0.08)'],
                url: '#3b82f6',
                notes: '#f59e0b',
                calendar: '#ec4899',
                quote: '#8b5cf6',
                suggestions: '#14b8a6'
            },
            grey: {
                name: 'Grey',
                bg: ['#e5e7eb', '#d1d5db', '#cbd5e1', '#e2e8f0'],
                text: '#1f2937',
                textSecondary: '#6b7280',
                card: 'rgba(255, 255, 255, 0.8)',
                cardBorder: 'rgba(209, 213, 219, 0.6)',
                cardShadow: 'rgba(0, 0, 0, 0.1)',
                orbs: ['rgba(59, 130, 246, 0.15)', 'rgba(139, 92, 246, 0.15)', 'rgba(236, 72, 153, 0.1)'],
                url: '#3b82f6',
                notes: '#f59e0b',
                calendar: '#ec4899',
                quote: '#8b5cf6',
                suggestions: '#14b8a6'
            },
            dark: {
                name: 'Dark',
                bg: ['#374151', '#4b5563', '#6b7280', '#9ca3af'],
                text: '#f9fafb',
                textSecondary: '#d1d5db',
                card: 'rgba(55, 65, 81, 0.8)',
                cardBorder: 'rgba(107, 114, 128, 0.4)',
                cardShadow: 'rgba(0, 0, 0, 0.3)',
                orbs: ['rgba(59, 130, 246, 0.25)', 'rgba(139, 92, 246, 0.25)', 'rgba(236, 72, 153, 0.2)'],
                url: '#60a5fa',
                notes: '#fbbf24',
                calendar: '#f472b6',
                quote: '#a78bfa',
                suggestions: '#5eead4'
            },
            blue: {
                name: 'Blue',
                bg: ['#dbeafe', '#bfdbfe', '#93c5fd', '#60a5fa'],
                text: '#1e3a8a',
                textSecondary: '#3b82f6',
                card: 'rgba(255, 255, 255, 0.85)',
                cardBorder: 'rgba(147, 197, 253, 0.6)',
                cardShadow: 'rgba(37, 99, 235, 0.1)',
                orbs: ['rgba(59, 130, 246, 0.2)', 'rgba(96, 165, 250, 0.15)', 'rgba(37, 99, 235, 0.1)'],
                url: '#2563eb',
                notes: '#f59e0b',
                calendar: '#0ea5e9',
                quote: '#6366f1',
                suggestions: '#06b6d4'
            },
            purple: {
                name: 'Purple',
                bg: ['#f3e8ff', '#e9d5ff', '#d8b4fe', '#c084fc'],
                text: '#581c87',
                textSecondary: '#7c3aed',
                card: 'rgba(255, 255, 255, 0.85)',
                cardBorder: 'rgba(216, 180, 254, 0.6)',
                cardShadow: 'rgba(124, 58, 237, 0.1)',
                orbs: ['rgba(139, 92, 246, 0.2)', 'rgba(168, 85, 247, 0.15)', 'rgba(124, 58, 237, 0.1)'],
                url: '#7c3aed',
                notes: '#f59e0b',
                calendar: '#ec4899',
                quote: '#8b5cf6',
                suggestions: '#a855f7'
            },
            green: {
                name: 'Green',
                bg: ['#d1fae5', '#a7f3d0', '#6ee7b7', '#34d399'],
                text: '#065f46',
                textSecondary: '#059669',
                card: 'rgba(255, 255, 255, 0.85)',
                cardBorder: 'rgba(110, 231, 183, 0.6)',
                cardShadow: 'rgba(5, 150, 105, 0.1)',
                orbs: ['rgba(16, 185, 129, 0.2)', 'rgba(52, 211, 153, 0.15)', 'rgba(5, 150, 105, 0.1)'],
                url: '#047857',
                notes: '#f59e0b',
                calendar: '#10b981',
                quote: '#14b8a6',
                suggestions: '#059669'
            },
            pink: {
                name: 'Pink',
                bg: ['#fce7f3', '#fbcfe8', '#f9a8d4', '#f472b6'],
                text: '#831843',
                textSecondary: '#be185d',
                card: 'rgba(255, 255, 255, 0.85)',
                cardBorder: 'rgba(249, 168, 212, 0.6)',
                cardShadow: 'rgba(190, 24, 93, 0.1)',
                orbs: ['rgba(236, 72, 153, 0.2)', 'rgba(244, 114, 182, 0.15)', 'rgba(190, 24, 93, 0.1)'],
                url: '#be185d',
                notes: '#f97316',
                calendar: '#ec4899',
                quote: '#db2777',
                suggestions: '#f43f5e'
            },
            orange: {
                name: 'Orange',
                bg: ['#fed7aa', '#fdba74', '#fb923c', '#f97316'],
                text: '#7c2d12',
                textSecondary: '#c2410c',
                card: 'rgba(255, 255, 255, 0.85)',
                cardBorder: 'rgba(251, 146, 60, 0.6)',
                cardShadow: 'rgba(194, 65, 12, 0.1)',
                orbs: ['rgba(249, 115, 22, 0.2)', 'rgba(251, 146, 60, 0.15)', 'rgba(194, 65, 12, 0.1)'],
                url: '#c2410c',
                notes: '#f59e0b',
                calendar: '#fb923c',
                quote: '#ea580c',
                suggestions: '#dc2626'
            },
            slate: {
                name: 'Slate',
                bg: ['#1e293b', '#334155', '#475569', '#64748b'],
                text: '#f1f5f9',
                textSecondary: '#94a3b8',
                card: 'rgba(51, 65, 85, 0.7)',
                cardBorder: 'rgba(148, 163, 184, 0.3)',
                cardShadow: 'rgba(0, 0, 0, 0.2)',
                orbs: ['rgba(59, 130, 246, 0.2)', 'rgba(139, 92, 246, 0.2)', 'rgba(236, 72, 153, 0.15)'],
                url: '#60a5fa',
                notes: '#fbbf24',
                calendar: '#f472b6',
                quote: '#a78bfa',
                suggestions: '#2dd4bf'
            },
            midnight: {
                name: 'Midnight',
                bg: ['#0f172a', '#1e1b4b', '#164e63', '#1e293b'],
                text: '#f1f5f9',
                textSecondary: '#94a3b8',
                card: 'rgba(30, 41, 59, 0.7)',
                cardBorder: 'rgba(148, 163, 184, 0.3)',
                cardShadow: 'rgba(0, 0, 0, 0.3)',
                orbs: ['rgba(59, 130, 246, 0.25)', 'rgba(139, 92, 246, 0.25)', 'rgba(236, 72, 153, 0.2)'],
                url: '#60a5fa',
                notes: '#fbbf24',
                calendar: '#f472b6',
                quote: '#a78bfa',
                suggestions: '#06b6d4'
            }
        };

        function setTheme(themeKey) {
            const theme = colorThemes[themeKey];
            if (!theme) return;

            document.body.style.setProperty('--bg-gradient-1', theme.bg[0]);
            document.body.style.setProperty('--bg-gradient-2', theme.bg[1]);
            document.body.style.setProperty('--bg-gradient-3', theme.bg[2]);
            document.body.style.setProperty('--bg-gradient-4', theme.bg[3]);
            document.body.style.setProperty('--text-primary', theme.text);
            document.body.style.setProperty('--text-secondary', theme.textSecondary);
            document.body.style.setProperty('--card-bg', theme.card);
            document.body.style.setProperty('--card-border', theme.cardBorder);
            document.body.style.setProperty('--card-shadow', theme.cardShadow);
            document.body.style.setProperty('--orb-1', theme.orbs[0]);
            document.body.style.setProperty('--orb-2', theme.orbs[1]);
            document.body.style.setProperty('--orb-3', theme.orbs[2]);
            document.body.style.setProperty('--url-color', theme.url);
            document.body.style.setProperty('--notes-color', theme.notes);
            document.body.style.setProperty('--calendar-color', theme.calendar);
            document.body.style.setProperty('--quote-color', theme.quote);
            document.body.style.setProperty('--suggestions-color', theme.suggestions);
            document.body.style.setProperty('--card-hover-border', theme.url);

            // Update color picker inputs to match theme
            document.getElementById('customBg1').value = theme.bg[0];
            document.getElementById('customBg2').value = theme.bg[1];
            document.getElementById('customBg3').value = theme.bg[2];
            document.getElementById('customBg4').value = theme.bg[3];
            document.getElementById('customText').value = theme.text;
            document.getElementById('customUrl').value = theme.url;
            document.getElementById('customNotes').value = theme.notes;
            document.getElementById('customCalendar').value = theme.calendar;
            document.getElementById('customQuote').value = theme.quote;
            document.getElementById('customSuggestions').value = theme.suggestions;
            document.getElementById('customHoverBorder').value = theme.url;
            document.getElementById('cardOpacity').value = 80;
            document.getElementById('opacityValue').textContent = 80;
            document.getElementById('cardHoverOpacity').value = 95;
            document.getElementById('hoverOpacityValue').textContent = 95;

            // Save the actual color values instead of theme name
            saveThemeColors({
                bg1: theme.bg[0],
                bg2: theme.bg[1],
                bg3: theme.bg[2],
                bg4: theme.bg[3],
                text: theme.text,
                url: theme.url,
                notes: theme.notes,
                calendar: theme.calendar,
                quote: theme.quote,
                suggestions: theme.suggestions,
                hoverBorder: theme.url,
                opacity: 80,
                hoverOpacity: 95
            });

            updateThemePickerActive(themeKey);
        }

        function getTheme() {
            const match = document.cookie.match(/theme=([^;]+)/);
            return match ? match[1] : 'grey';
        }

        function updateThemePickerActive(themeKey) {
            document.querySelectorAll('.color-option').forEach(opt => {
                opt.classList.toggle('active', opt.dataset.theme === themeKey);
            });
        }

        function updateCustomColor(type, value) {
            // Clear preset selection
            document.querySelectorAll('.color-option').forEach(opt => {
                opt.classList.remove('active');
            });

            // Update CSS variable
            switch(type) {
                case 'bg1':
                    document.body.style.setProperty('--bg-gradient-1', value);
                    break;
                case 'bg2':
                    document.body.style.setProperty('--bg-gradient-2', value);
                    break;
                case 'bg3':
                    document.body.style.setProperty('--bg-gradient-3', value);
                    break;
                case 'bg4':
                    document.body.style.setProperty('--bg-gradient-4', value);
                    break;
                case 'text':
                    document.body.style.setProperty('--text-primary', value);
                    break;
                case 'url':
                    document.body.style.setProperty('--url-color', value);
                    break;
                case 'notes':
                    document.body.style.setProperty('--notes-color', value);
                    break;
                case 'calendar':
                    document.body.style.setProperty('--calendar-color', value);
                    break;
                case 'quote':
                    document.body.style.setProperty('--quote-color', value);
                    break;
                case 'suggestions':
                    document.body.style.setProperty('--suggestions-color', value);
                    break;
                case 'hoverBorder':
                    document.body.style.setProperty('--card-hover-border', value);
                    break;
            }

            // Save custom colors to cookie
            saveCustomColors();
        }

        function updateCardOpacity(value) {
            const opacity = value / 100;
            document.body.style.setProperty('--card-opacity', opacity);
            document.getElementById('opacityValue').textContent = value;
            saveCustomColors();
        }

        function updateCardHoverOpacity(value) {
            const opacity = value / 100;
            document.body.style.setProperty('--card-hover-opacity', opacity);
            document.getElementById('hoverOpacityValue').textContent = value;
            saveCustomColors();
        }

        function saveThemeColors(colors) {
            document.cookie = `themeColors=${encodeURIComponent(JSON.stringify(colors))};path=/;max-age=31536000`;
        }

        function saveCustomColors() {
            const customColors = {
                bg1: document.getElementById('customBg1').value,
                bg2: document.getElementById('customBg2').value,
                bg3: document.getElementById('customBg3').value,
                bg4: document.getElementById('customBg4').value,
                text: document.getElementById('customText').value,
                url: document.getElementById('customUrl').value,
                notes: document.getElementById('customNotes').value,
                calendar: document.getElementById('customCalendar').value,
                quote: document.getElementById('customQuote').value,
                suggestions: document.getElementById('customSuggestions').value,
                hoverBorder: document.getElementById('customHoverBorder').value,
                opacity: document.getElementById('cardOpacity').value,
                hoverOpacity: document.getElementById('cardHoverOpacity').value
            };
            saveThemeColors(customColors);
        }

        function loadCustomColors() {
            const match = document.cookie.match(/customColors=([^;]+)/);
            if (match) {
                try {
                    const colors = JSON.parse(decodeURIComponent(match[1]));
                    document.getElementById('customBg1').value = colors.bg1;
                    document.getElementById('customBg2').value = colors.bg2;
                    document.getElementById('customBg3').value = colors.bg3;
                    document.getElementById('customBg4').value = colors.bg4;
                    document.getElementById('customText').value = colors.text;
                    document.getElementById('customUrl').value = colors.url;
                    document.getElementById('customNotes').value = colors.notes;
                    document.getElementById('customCalendar').value = colors.calendar || '#ec4899';
                    document.getElementById('customQuote').value = colors.quote || '#8b5cf6';
                    document.getElementById('customSuggestions').value = colors.suggestions || '#14b8a6';

                    document.body.style.setProperty('--bg-gradient-1', colors.bg1);
                    document.body.style.setProperty('--bg-gradient-2', colors.bg2);
                    document.body.style.setProperty('--bg-gradient-3', colors.bg3);
                    document.body.style.setProperty('--bg-gradient-4', colors.bg4);
                    document.body.style.setProperty('--text-primary', colors.text);
                    document.body.style.setProperty('--url-color', colors.url);
                    document.body.style.setProperty('--notes-color', colors.notes);
                    document.body.style.setProperty('--calendar-color', colors.calendar || '#ec4899');
                    document.body.style.setProperty('--quote-color', colors.quote || '#8b5cf6');
                    document.body.style.setProperty('--suggestions-color', colors.suggestions || '#14b8a6');
                } catch(e) {
                    console.error('Error loading custom colors:', e);
                }
            }
        }

        async function resetTheme() {
            setTheme('grey');

            // Also reset card visibility to defaults
            localStorage.removeItem('cardVisibility');

            // If default visibility is configured, apply it
            if (Object.keys(defaultVisibility).length > 0) {
                saveCardVisibilityState(defaultVisibility);
            }

            // Reload the page to apply visibility changes
            setTimeout(() => {
                window.location.reload();
            }, 500);

            document.getElementById('themePickerMenu').classList.remove('show');
        }

        // Initialize theme on load
        document.addEventListener('DOMContentLoaded', function() {
            const colorMatch = document.cookie.match(/themeColors=([^;]+)/);
            if (colorMatch) {
                try {
                    const colors = JSON.parse(decodeURIComponent(colorMatch[1]));
                    document.body.style.setProperty('--bg-gradient-1', colors.bg1);
                    document.body.style.setProperty('--bg-gradient-2', colors.bg2);
                    document.body.style.setProperty('--bg-gradient-3', colors.bg3);
                    document.body.style.setProperty('--bg-gradient-4', colors.bg4);
                    document.body.style.setProperty('--text-primary', colors.text);
                    document.body.style.setProperty('--url-color', colors.url);
                    document.body.style.setProperty('--notes-color', colors.notes);
                    document.body.style.setProperty('--calendar-color', colors.calendar || '#ec4899');
                    document.body.style.setProperty('--quote-color', colors.quote || '#8b5cf6');
                    document.body.style.setProperty('--suggestions-color', colors.suggestions || '#14b8a6');
                    if (colors.hoverBorder) document.body.style.setProperty('--card-hover-border', colors.hoverBorder);
                    if (colors.opacity) {
                        document.body.style.setProperty('--card-opacity', colors.opacity / 100);
                        document.getElementById('cardOpacity').value = colors.opacity;
                        document.getElementById('opacityValue').textContent = colors.opacity;
                    }
                    if (colors.hoverOpacity) {
                        document.body.style.setProperty('--card-hover-opacity', colors.hoverOpacity / 100);
                        document.getElementById('cardHoverOpacity').value = colors.hoverOpacity;
                        document.getElementById('hoverOpacityValue').textContent = colors.hoverOpacity;
                    }

                    // Set input field values
                    document.getElementById('customBg1').value = colors.bg1;
                    document.getElementById('customBg2').value = colors.bg2;
                    document.getElementById('customBg3').value = colors.bg3;
                    document.getElementById('customBg4').value = colors.bg4;
                    document.getElementById('customText').value = colors.text;
                    document.getElementById('customUrl').value = colors.url;
                    document.getElementById('customNotes').value = colors.notes;
                    document.getElementById('customCalendar').value = colors.calendar || '#ec4899';
                    document.getElementById('customQuote').value = colors.quote || '#8b5cf6';
                    document.getElementById('customSuggestions').value = colors.suggestions || '#14b8a6';
                    if (colors.hoverBorder) document.getElementById('customHoverBorder').value = colors.hoverBorder;
                } catch(e) {
                    console.error('Error loading theme colors:', e);
                    applySystemTheme();
                }
            } else {
                // Auto-detect dark mode preference if no theme saved
                applySystemTheme();
            }

            // Listen for system theme changes
            const darkModeQuery = window.matchMedia('(prefers-color-scheme: dark)');
            darkModeQuery.addEventListener('change', (e) => {
                const colorMatch = document.cookie.match(/themeColors=([^;]+)/);
                // Only auto-switch if user hasn't set a custom theme
                if (!colorMatch) {
                    applySystemTheme();
                }
            });
        });

        function applySystemTheme() {
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            setTheme(prefersDark ? 'dark' : 'grey');
        }
    </script>

    <!-- Theme Picker -->
    <div class="theme-picker">
        <div class="theme-picker-toggle" onclick="toggleThemePicker()">
            <i class="fas fa-palette"></i>
        </div>
        <div class="theme-picker-menu" id="themePickerMenu">
            <div class="theme-section-title">Presets</div>
            <div class="color-grid">
                <div class="color-option" data-theme="light" onclick="setTheme('light')">
                    <div class="color-preview" style="background: linear-gradient(135deg, #ffffff, #f3f4f6);"></div>
                </div>
                <div class="color-option" data-theme="grey" onclick="setTheme('grey')">
                    <div class="color-preview" style="background: linear-gradient(135deg, #d1d5db, #e2e8f0);"></div>
                </div>
                <div class="color-option" data-theme="dark" onclick="setTheme('dark')">
                    <div class="color-preview" style="background: linear-gradient(135deg, #4b5563, #6b7280);"></div>
                </div>
                <div class="color-option" data-theme="blue" onclick="setTheme('blue')">
                    <div class="color-preview" style="background: linear-gradient(135deg, #93c5fd, #60a5fa);"></div>
                </div>
                <div class="color-option" data-theme="purple" onclick="setTheme('purple')">
                    <div class="color-preview" style="background: linear-gradient(135deg, #d8b4fe, #c084fc);"></div>
                </div>
                <div class="color-option" data-theme="green" onclick="setTheme('green')">
                    <div class="color-preview" style="background: linear-gradient(135deg, #6ee7b7, #34d399);"></div>
                </div>
                <div class="color-option" data-theme="pink" onclick="setTheme('pink')">
                    <div class="color-preview" style="background: linear-gradient(135deg, #f9a8d4, #f472b6);"></div>
                </div>
                <div class="color-option" data-theme="orange" onclick="setTheme('orange')">
                    <div class="color-preview" style="background: linear-gradient(135deg, #fb923c, #f97316);"></div>
                </div>
                <div class="color-option" data-theme="slate" onclick="setTheme('slate')">
                    <div class="color-preview" style="background: linear-gradient(135deg, #334155, #475569);"></div>
                </div>
                <div class="color-option" data-theme="midnight" onclick="setTheme('midnight')">
                    <div class="color-preview" style="background: linear-gradient(135deg, #0f172a, #1e1b4b);"></div>
                </div>
            </div>

            <div class="theme-divider"></div>

            <div class="theme-section-title">Custom Colors</div>
            <div class="custom-colors">
                <div class="color-control">
                    <label>BG 1</label>
                    <input type="color" id="customBg1" value="#e5e7eb" onchange="updateCustomColor('bg1', this.value)">
                </div>
                <div class="color-control">
                    <label>BG 2</label>
                    <input type="color" id="customBg2" value="#d1d5db" onchange="updateCustomColor('bg2', this.value)">
                </div>
                <div class="color-control">
                    <label>BG 3</label>
                    <input type="color" id="customBg3" value="#cbd5e1" onchange="updateCustomColor('bg3', this.value)">
                </div>
                <div class="color-control">
                    <label>BG 4</label>
                    <input type="color" id="customBg4" value="#e2e8f0" onchange="updateCustomColor('bg4', this.value)">
                </div>
                <div class="color-control">
                    <label>Text</label>
                    <input type="color" id="customText" value="#1f2937" onchange="updateCustomColor('text', this.value)">
                </div>
                <div class="color-control">
                    <label>URL</label>
                    <input type="color" id="customUrl" value="#3b82f6" onchange="updateCustomColor('url', this.value)">
                </div>
                <div class="color-control">
                    <label>Notes</label>
                    <input type="color" id="customNotes" value="#f59e0b" onchange="updateCustomColor('notes', this.value)">
                </div>
                <div class="color-control">
                    <label>Calendar</label>
                    <input type="color" id="customCalendar" value="#ec4899" onchange="updateCustomColor('calendar', this.value)">
                </div>
                <div class="color-control">
                    <label>Quote</label>
                    <input type="color" id="customQuote" value="#8b5cf6" onchange="updateCustomColor('quote', this.value)">
                </div>
                <div class="color-control">
                    <label>Suggestions</label>
                    <input type="color" id="customSuggestions" value="#10b981" onchange="updateCustomColor('suggestions', this.value)">
                </div>
                <div class="color-control">
                    <label>Card Hover Border</label>
                    <input type="color" id="customHoverBorder" value="#3b82f6" onchange="updateCustomColor('hoverBorder', this.value)">
                </div>
                <div class="color-control" style="grid-column: 1 / -1;">
                    <label>Card Opacity: <span id="opacityValue">80</span>%</label>
                    <input type="range" id="cardOpacity" min="0" max="100" value="80" onchange="updateCardOpacity(this.value)" style="width: 100%;">
                </div>
                <div class="color-control" style="grid-column: 1 / -1;">
                    <label>Card Hover Opacity: <span id="hoverOpacityValue">95</span>%</label>
                    <input type="range" id="cardHoverOpacity" min="0" max="100" value="95" onchange="updateCardHoverOpacity(this.value)" style="width: 100%;">
                </div>
            </div>

            <button class="reset-theme-btn" onclick="resetTheme()">
                <i class="fas fa-undo"></i> Reset to Default
            </button>
        </div>
    </div>

    <script>
        function toggleThemePicker() {
            const menu = document.getElementById('themePickerMenu');
            menu.classList.toggle('show');
        }

        // Close theme picker when clicking outside
        document.addEventListener('click', function(e) {
            const themePicker = document.querySelector('.theme-picker');
            if (!themePicker.contains(e.target)) {
                document.getElementById('themePickerMenu').classList.remove('show');
            }
        });
    </script>
</body>
</html>